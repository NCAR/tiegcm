

!======================================================================

Oct 04 -> May 05:

Development on tiegcm1.6 leading to tiegcm1.7, tiegcm1.8dev1, 
tiegcm1.8dev2, and the tiegcm1.8 "tuning release", dev/tiegcm1.8: 

!======================================================================



10/21/04: Changed #include statements from "file.h" to <file.h>.
Used perl /home/foster/tgcm/scripts/change_incs_bracks.

10/29/04:
Small change to print format statement in advance.F.
Fixed dispose.F to correct password problem in mscomment (see save/dispose.old)

!-----------------------------------------------------------------------

1/10/05:
Copied source from /home/tgcm/tiegcm1.6/src and scripts from ~/tgcm/scripts.
Modifying source for lightning linux cluster, like ~/tgcm/timegcm/src.
This is currently not a CVS working directory -- CVS working directory
is ~/tiegcm/tiegcm, but this dir (from /home/tgcm/tiegcm/src) is more
up to date. At some point (when code is working on lightning), this
should become the CVS working dir.

1/10/05:
Removed nc_xxxx routines from nchist.F, replacing them with the netcdf
functions nf_xxxx. The routine nc_get_var_real (nf_get_var_double) was
being used incorrectly (getting scalar when var is a vector with time
dimension). Now using nf_get_var1_double to get scalar at time itime. 
(see, e.g., reading f107a, f107d, etc). Same for ints that are dimensioned
in time.

1/11/05:
Determined that -fastsse does not work for dynamo (problem w/ rhs).
So mpif90 optimization should be -O2 -fast.

1/12/05:
Cleaning up for lighting: added shutdown routine (util.F), and several
other routines in util.F. Changed output, nchist, etc so that disk
file names can be used for SOURCE, OUTPUT, or SECOUT.

Changed some dimensions to avoid out-of-bounds check by the compiler.
Can now use -g -C to check for out-of-bounds. (see esp, dynamo.F, where
array() was changed to wkarray(), and put in module data).

Removed "old" dynamo option (dynamo_old.F). Now the namelist read parameter
DYNAMO <= 0 -> no dynamo, or
DYNAMO >  0 -> dynamo ("new" only)

tempdir can now be blank (which has same effect as tempdir==.).

2/2/05: This is now a CVS working directory for project tiegcm,
including scripts and src directories. Repository is /home/tgcm/cvs/tiegcm.

Feb, 2005: Rewrote timing module, as in timegcm1.2. See timing.F, and
calls in advance.F and dynamics.F.

2/10/05: Copied updated scripts from ~foster/tgcm/scripts to ~foster/tgcmtiegcm/scripts.

2/10-11/05: Verified that results are the same as 1.6: got 0 diffs between
1.6 and 1.7 runs on the same platform, and near-zero (1.e-5) diffs between
platforms.

2/11/05: Committing to CVS repository, and tagging as tiegcm1-7.

!-----------------------------------------------------------------------

Changes from tiegcm1.7 to tiegcm1.8:

2/28/05: Using k instead of k+1 in mbar calculation in dt.F.

3/18/05: 
Added check_nans, see util.F and nchist.F. Finding nans when
writing prognostic fields is fatal, see nanfatal in nchist.F.  

Putting read of magfield data file back in for use only when
dynamo==0 (was crashing on lightning). See tgcm.F and magfield.F.

Swapped loop order for efficiency near top of sub nodynamo (dynamo.F).

3/28/05:
Merged Astrid's mods to dynamo (/callisto/i/maute/teTex.d/merge_w1.7).
This included 2 new source files: highlatpoten.F and magpres_g.F.
Extensive changes to dynamo.F, current.F, apex.F.

4/4/05 btf:
Added gswm options to bndry.F, addiag.F, dt.F, and duv.F. This eliminates
source files bndry_gswm.F, addiag_gswm.F, dt_gswm.F, and duv_gswm.F.
Did "cvs remove" on the eliminated files. This will take effect with
the next cvs commit.
Also consolidated gswm calls from advance.F to sub getgswm in gswm.F.
Also changed gswm flags and file names for non-migrating tides
(i.e., gswmnmidi and gswmnmisdi changed to gswmnmdi and gswmnmsdi).

4/6/05:
CVS tagged code with "cvs -q tag tiegcm1-7+gswm+maute".
I.e., mods to tiegcm1-7 so far, including gswm and maute mods,
but prior to merging lqian code.

4/6/05:
Merged Liying's mods (lqian/):
Mods to: aurora.F, chemrates.F, dynamics.F, init.F, input.F, newton.F,
qinite.F, qrj.F, tgcm.F, util.F. Removed files xray.F and qtieff.F,
and added new source file soldata.F. There is a new namelist parameter
SD_NCFILE, specifying SEE data netcdf file. The default SEE data file
is $TGCMDATA/see__L3_merged_2005007_007.nc. 

Added this default file to scripts/MkNamelist for tiegcm (commented out). 
Also added copy of this file to exec dir by scripts/tgcm_config. The new 
MkNamelist and tgcm_config were distributed to model scripts directories 
at both hao and scd.

Added new global file attribute for sd_ncfile to histories (nchist.F).
If sd_ncfile is not in use, the attribute value is "[none]".

Commented many addfsech calls (mostly in maute code dynamo, hightlat*, 
magpres*, etc.)

CVS tagged code with "cvs -q tag tiegcm1-7+gswm+maute+lqian", but this
turned out to be incorrect -- it tags the current repository, not the
working directory from which the tag command is given. One must do a
commit, *then* save a tag.  Consequently, we do not have a version from 
after maute dynamo mods but before lqian qrj and SEE data mods.

Broke init_fields (fields.F) into 2 routines: init_4d and init_3d.
This allows compilation on certain flavors of pgf90 (e.g., on HAO Callisto)
Changes to fields.F and init.F.

4/7/05:
Doing a cvs commit, and tagging as tiegcm1-8dev1: this is leading up
to a pre-release of tiegcm1-8. This code is essentially tiegcm1-7 plus 
the following:
  -- maute dynamo mods
  -- lqian euv/qrj and SEE data option
  -- foster gswm mods (combine dt.F and dt_gswm.F, etc.)

4/19-20/05:
Copied Liying's new ~lqian/aurora.F, with qtef fix. This was causing
problems on lightning with 8 processors.

4/21/05: Made 2 10-day runs, one with periodic points and boundary
longitudes set in dt.F, and one without. Making these calls was
recommended by Wenbin (see ~foster/tgcm/tiegcm/doc/wenbin). However,
there were zero differences in all major fields after 10 days,
according to tgcmproc_f90. 

Uncommented mp_bndlons_f3d and mp_periodic_f3d in dt.F, as per
Wenbin's request.

4/22/05: 
Saving this code as "tiegcm1.8dev2", CVS tag "tiegcm1-8dev2".

Executed:
cvs commit -m "tag tiegcm1-8dev2: dynamo currents and high-latitude options, new EUV/qrj parameterization, Timed SEE data option, updated chemrates"

cvs tag tiegcm1-8dev2
!-----------------------------------------------------------------------

5/3/05:
Added sub expand_path in util.F, called by getfile, so user can imbed
env vars in file paths (e.g. in SOURCE, GPI_FILE, etc). E.g.:

 SOURCE='$TGCMDATA/TGCM.tiegcm.p001-2002-080.nc'
 SOURCE='$MYDIR/FOSTER.tiegcm1.8.peqnx_001.nc'
 SOURCE='/hao/$MYSUBDIR/FOSTER.tiegcm1.8.peqnx_001.nc'
 SOURCE='$MYDIR/$MYSUBDIR/FOSTER.tiegcm1.8.peqnx_001.nc'
 SOURCE='/TGCM/data/TGCM.tiegcm.p001-2002-080.nc'

Note expand_path is recursive, so multiple env vars can be imbedded in
the path, as in example 4 above. If a '$' is not found in the path,
expand_path simply returns without changing path, e.g., in the last
example above.

Committing this to CVS, and giving it to Ray for tuning prior to
the "pre-release" to hao AIM. This model is saved in
$TGCMROOT/dev/tiegcm1.8/ at both hao and scd.

5/5/05: Ray says this is ok for tuning release. Tagging as tiegcm1-8tune.
Source is in $TGCMDATA/dev/tiegcm1.8/ (HAO and SCD). Also tar file is
/toshi/ftp/pub/tgcm/tar/tiegcm1.8tune.tar.

5/5/05: Allow "/TGCM/" to be an mspath (in addition to "/LOGNAME/" in 
function is_mspath (util.F)

Enable env var to be included in file path names, e.g.,
SOURCE = '$TGCMDATA/...'

5/11/05: Removed mpi_barrier call in putms to prevent job from hanging
when DISPOSE=1 (putms is called by master task only).

5/12/05: Preparing tiegcm1.8 "tuning release", see doc/README_1.8tune
CVS tag will be tiegcm1.8tune, source in $TGCMROOT/dev/tiegcm1.8.

!-----------------------------------------------------------------------
Mods after tiegcm1.8 tuning release (i.e., after 3:30 pm, May 12, 2005):

5/12/05: Fixed function b_search (util.F) to compile on SGI tempest.

5/27/05: Copied new soldata.F and util.F from Liying, so shutdown is
called if model date/time are not found in available SEE data.
(I changed function name real_bsearch to int_bsearch in util.F,
but this was later changed to b_search on 7/28)

Also, put int dummy declaration before inarray declaration in both
int_bsearch and long_bsearch, for the SGI compiler (as in 5/12 above).

7/8/05: Changed length of line read by sub rmcomments (util.F) from 
80 to 6400, so namelist read lines in .inp file can be long (thanks to 
Cedric St-Jean).

7/20/05: In soldata.F, changed 
  include "netcdf.inc" to 
  include <netcdf.inc>

7/21/05: Fix function my_msrcp so only master MPI task does msrcp command.

7/28-29/05: Demerged first attempts to remove storing t,u,v lbc in top
slot. This was premature. Saved this version of cvs working directory
in /e/foster/tiegcm/tiegcm-mywrk. Then merged in the above changes, since
5/12, and included Astrid's mods for new lamdas, qjoule (which were
saved as tiegcm1-8tune1 earlier this week).

Also saving several minor changes in scripts (updated gpi and ncep files
in tgcm_config and MkNamelist, added SEE data file, removed dave and
blackforest from some job scripts (they were still in repos versions,
new locations for lightning netcdf libs,etc).

7/29/05: Made default test runs on callisto (hao), bluesky, lightning,
and tempest.  Doing cvs commit, and tagging this as tiegcm1-8tune2.

7/25/07: am
rewritten lamdas.F; correct Joule heating for ions qjoule.F; include vertical 
velocity difference for Joule heating calculation which goes into neutrals 
qjoule.F

9/22/05: Updated apex_subs.F from Astrid -- this has new apex coefficients
for 1995, 2000, 2005.. Copied her file from /home/maute/apex.d/modsrc_apexmod.

Also improved expand_path (util.F) for expanding env vars used in
file specs in namelist read. 

1/18/06: 
  Fix "mgr bug" in oplus 
  Reference lev1 (rather than lev0) for tn lbc in comp.F, because lbc is
    still in top slot.

Doing cvs commit to update these 2 changes and the new apex.F. 

#-----------------------------------------------------------------------
4/2/07: See dynamo mod by Astrid, in ../consult/astrid.dynamo.
See also $TGCMROOT/tiegcm1.8/src/modsrc/dynamo.F and README.

8/13/07 btf:
Changed init of dynpot lons from nlonp4 to nlonp1 in sub set_dynpot
(rdsource.F) because dynpot is dimensioned nlonp1 (fields.F). This
subroutine is called only for non-mpi serial runs. This was pointed
out by George Millward.

!+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
10/23/07  am
  Minor correction to dynamo.F, pointed out by Wenbin:
  dynamo.F: line 843-844
  correct the hemispherical adjustment of the high latitude electric potential
  This adjustment is done for asymmetric high latitude potential pattern for
  HEELIS and Weimer (not working at the moment).
  Therefore, fac = 1 (line 842)
  Heelis pattern is hemispherically symmetric, therfore 
  phihm(i,southH_n)-phihm(i,northH_n) = 0
  For modified Heelis (mod_heelis=.true.), we don't want this correction, 
  since it's symmetric anyway,
  therefore fac = 0.

  This was an error in the code, but since we had only hemispherically 
  symmetric potential pattern, we didn't get wrong results.

10/25/07 am
  modifications to use directly the calculated electric field from 
  the electrodynamo part instead of starting from the electric potential
  in efield.F.
  NOTE: mpi is done for each field separately instead of combining the
    field and then do one passing (see ).

10/25/07 btf
Updated scripts directory from hao:$TGCMROOT/tiegcm1.8/scripts and commit

11/7/07 btf: Changed use-assoc from params module in heelis.F to avoid
conflict w/ dummy args. This is for the IRIX compiler (it was not a 
problem under AIX).

!--------------------------------------------------------------------------
11/7/07 btf:
Begin major revision to use history mechanism and other improvements from 
tiegcm-hist-lbc, but retain 97 km lbc.

11/9/07 btf: Many changes, including copying several files from tiegcm-hist-lbc
model (nchist.F, output.F, hist.F, etc). This code runs but produces bad output
(NaNs, 0's, etc).  The "top slot" convention for t,u,v has not yet been removed. 
Saved this as tiegcm_runs1.tar. This code has removed addfsech, and has addfld, 
but the addfsech calls have not yet been converted to addfld calls.

11/14/07: Is running now and results look ok. "Top slot" convention has been
removed. Removed OX and O3, and 3d fields gswm_rfu,rfv, eddy, vo3, sco3, o1d.
Am now completing conversion of addfsech calls to addfld.

Had to set mxlev==ilev1==nlevp1 in mp_gather2root_sech in mpi.F because
nmlev > nlevp1 because of extra levels below lbc in dynamo.

11/19/07: Added Astrid's electric field calcs in dynamo, w/ changes to efield.
Now emx,emy,emz are calculated in efield only in first timestep, then efield is
calculated in dynamo as emphi3d, emlam3d, and ez3d, and copied to emx,y,z in
efield.

11/20/07: All addfsech calls are now converted to addfld.
Saved /oreo/d/foster/tiegcm/tiegcm1.81.tar

11/26/07: Have now made a full year 2002 run w/ this code. All primary files,
and selected secondary files, w/ utproc plots are in /aim/d/tgcm/tiegcm1.81_yr02.

Now preparing to do a commit, and will save tag tiegcm1-81. 
This code does *not* include most of the mods from $TGCMROOT/tiegcm1.8/src/modsrc.
Will notify the "dev" group about this commit, and suggest a meeting
to decide next steps, like including changes from tiegcm1.8/src/modsrc.

--------------------------------------------------------------------------------
1/7/08: Changes to 1.81, toward 1.82:

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
aurora.F
  - ed reduced from 0.5 to 0.11 (Gang Lu mod from July 28, 2006)

> ! 8/1/06 btf: change conditional as per Richmond suggestion:
> !     if (power >= 0.01) plevel = 2.09*alog(power)
>       if (power >= 1.00) plevel = 2.09*alog(power)

> !      e1 = (0.5 + 0.15 * power)
> !      e2 = (1.5 + 0.25 * power)
> ! modified by LQIAN, 2007
> ! produce realistic oval compared to NOAA empirical auroral oval and TIMED/GUVI
> ! e1 formula given by Wenbin base on POLARVIS image;
> ! e2 formula based on Emery et al original auroral parameterization report
>       e1 = max(0.50, -2.15 + 0.62*plevel)
>       e2=1.+0.11*power

> !      h1 = 2. + 0.05 * power
> !      h2 = 3. + 0.20 * power
> ! modified by LQIAN, 2007
> ! produce realistic oval compared to NOAA empirical auroral oval and TIMED/GUVI
> ! h1 formula given by Wenbin base on POLARVIS image;
> ! h2 formula based on Emery et al original auroral parameterization report
>       h1 = min(2.35, 0.83 + 0.33*plevel)
>       h2=2.5+0.025*max(power,55.)+0.01*min(0.,power-55.)

> !     alfa_1 = 2. 
>       alfa_1 = 1.5

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
duv.F
> #else
> !
> ! Set periodic points for serial run:
>       ztmp(:,1:2,:) = ztmp(:,lonend-2:lonend-1,:)
>       ztmp(:,lonend+1:lonend+2,:) = ztmp(:,3:4,:)

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
gpi.F

322,324d321
< ! Set minimum hemispheric power to 3 gw:
<         if (ipower > 0) power = max(3.,-2.78+9.33*fkp)
< !
326c323,337
<         if (ictpoten > 0) ctpoten = 29.+11.*fkp
---
> ! modified by LQIAN, 2007
> ! formula given by Wenbin based on data fitting
>         if (ictpoten > 0) ctpoten = 15.+15.*fkp + 0.8*fkp**2
> !
> ! Formula for hemispheric power:
> ! modified by LQIAN, 2007
> ! for fkp<=7: formula given by Zhang Yongliang based on TIMED/GUVI
> ! for fkp>7: power is 153.13 when fkp=7 from Zhang's formula, 
> ! assume power is 300.(based on NOAA satellites) when fkp=9 
> ! do linear interporation in between
>         if (ipower > 0)  then
>             if (fkp <=7.) power = 16.82*exp(0.32*fkp)-4.86
>             if (fkp > 7.) power = 153.13 + 
>      |                            (fkp-7.)/(9.-7.)*(300.-153.13)
>         endif
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
lamdas.F

237a238,247
> !
> ! 6/2/06 btf: Multiply rnu_ne by 4, as per Richmond:
> !
> ! The effective electron-neutral collision frequency is increased in 
> ! an an hoc manner by a factor of 4 in order for the model to produce
> ! electric fields and currents below 105 km that agree better with
> ! observations, as recommended by Gagnepain et al. (J. Atmos. Terr. 
> ! Phys., 39, 1119-1124, 1977).
> !
>       rnu_ne = rnu_ne*4.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
magfield.F

455c455
<           decmag(i+2,j) = -atan2(yb(i,j),xb(i,j))
---
>           decmag(i+2,j) = atan2(yb(i,j),xb(i,j))
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
qrj.F
 - Liying changes to ssflux call (wave1,wave2,sflux), and data initialization
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
soldata.F
228c228
<       integer,external::b_search
---
>       integer,external::real_bsearch
235c235,239
<       iyfrac=iyear+(iday-1+(iuttime/24.))/365.
---
>       if (mod(iyear,4) == 0) then
>          iyfrac=iyear+(iday-1+(iuttime/24.))/366.
>       else
>          iyfrac=iyear+(iday-1+(iuttime/24.))/365.
>       endif
250c254
<       index=b_search(yfrac(:,istruct),1,ndate,iyfrac)
---
>       index=real_bsearch(yfrac(:,istruct),1,ndate,iyfrac)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
util.F
 Added Liying functions: 
      integer function real_bsearch(inarray,first,last,key)
      integer function long_bsearch(inarray,first,last,key)
      integer function int_bsearch(inarray,first,last,key)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

1/7/08: Added #if conditionals around dipmin parameter, see cons.F and magfields.F.

1/8/08: Changed filtering mechanism to the simpler method used in timegcm,
i.e., #if to set kut in cons according to horizontal resolution. Removed
sub set_wave_filter. Added option to call filter and/or filter2 in oplus.
S.a. changes to sub filter in filter.F.

1/8/08: Model now runs at double resolution, but timestep must be reduced
to 60 seconds. Blueice took almost 1/2 hour to make a 1-day run at 60 sec
step (ave 1.16 secs/step) with 32 processors (dynamo used 44% of wallclock!)

1/11/08: Doing cvs commit and tagging as tiegcm1-82. (version name in params.F
changed from 1.81 to 1.82).

--------------------------------------------------------------------------------
1/14/08: Changed format of "Elapsed run time" in sub timer_report (timing.F).

1/24/08 btf: mods from Astrid:
am 1/22/08 (qinite.F, elden.F)
  change the flux in qinite
  from
        real,parameter :: al(3) = (/5.E4, 5.E3, 5.E3/)
  to     
        real,parameter :: al(3)=(/0.75E7,0.75E6,0.75E6/)
  The new triple values are from TIME-GCM.
  In addition remove the minimum electron density in elden.F
 
  Motivation:    
  the usage of the minimum electron density in elden.F was not consistent
  with the later ion calculation,
  and was leading to an unbalance in electrons and ions.
  It was decided that having a minimum electron density shouldn't
  be necessary if we have a better nighttime ionosphere. However,
  implementing formulations like Titheridge suggested was postponed for
  later. We looked at this a few years ago, and it wasn't straight forward to
  implement. So increasing the night time flux of the three lines (1026,304,584)
  seems reasonable, also TIME-GCM is using the same values.
  The nighttime NE at plev=-2 is around log(Ne)=3.2 at low latitudes. The
  prereversal enhancement is decreasing a bit (around 3-4 m/s) at JRO.

1/24/08 btf: aurora mods from Wenbin:
      EC=(0.24+0.0067*HP)/5   ! wb version
      ALFAC=0.1                                                             TAIL.114
      ED=0.0012+0.0006*HP  ! wb version
      ALFAD=0.50       ! wb version                                       TAIL.116

Added the following auroral parameters to the histories (single dimension in time,
see nchist.F)
     |    e1,e2,             ! peak auroral energy flux
     |    h1,h2,             ! gaussian half-width for aurora
     |    alfac,ec,          ! aurora cusp energy
     |    alfad,ed,          ! aurora drizzle energy

Removed alfa30,e30,alfad2,ed2 from the history (timegcm only)

Small change to print of timing results at end of program (sub timer_report
in timing.F)

Will remake tiegcm1-82 (including the cvs tag) with these changes.

1/30/08: Fixed path to double res tiegcm source file in Mknamelist.
Redo cvs commit and retag tiegcm1-82.
--------------------------------------------------------------------------------

2/1/08: Made a year-long 2002 run of tiegcm1-82, see /aim/d/tgcm/tiegcm1-82_yr02.

2/21/08: Roble and Foster present results of tiegcm1-82 year 2002 run,
including emperical model comparisons, generated by empproc f90 processor.

3/12/08:
Added $mss option to tgcm_config and job scripts. This can be either 
"TRUE" or "FALSE", indicating availability of the NCAR MSS. This is 
added to top of the Makefile by tgcm_config, and -DMSS set or not set 
accordingly.  Removed references to get_diskfile (rdsource.F and magfield.F).
Tested with and without mss on blueice.

3/12/08:
Allow Weimer model wei01gcm.F to be called (namelist read parameter 
"potential_model", and if so, force one of byimf,bzimf to be non-zero 
(see input.F). This appears to be working.

Added option for user to provide time-dependent byimf, bzimf, swden, 
swvel, and al in namelist read file. This is similiar to ctpoten and 
hpower. Also added these to the histories.

3/28/08:
Completed new full year run of tiegcm1.82 for 2002, saving hourly
secondary histories for the entire year. Documentation (but not history 
files) is in /aim/d/tgcm/tiegcm1-82_yr02c.  There were no mods (all 
source in $TGCMDATA/tiegcm1-82).

4/2/08: 
Introducing Weimer 2005 model for electric potential. There are two
new source files: w05sc.F and w05sc_rddat.F. Translation from original
IDL (obtained from Dan Weimer) to f90 was done in /oreo/d/foster/weimer05.
His original IDL data files were translated from xdr to ascii
(see /oreo/d/foster/weimer05/xdr_to_dat). They are now in $TGCMDATA.
(see w05sc_path in input.F). Now the namelist read potential_model
can be "NONE","HEELIS","WEIMER01", or "WEIMER05". 

Next steps will be to translate field-aligned current part of Weimer
2005 model, and write a netcdf file instead of using the ascii data files.

Added "indices_interp" to namelist read to indicate whether or not
time-dependent indices provided should be interpolated to model time.
Default is 1, so if the user sets indices_interp=0, then the indices
are changed only according to the given time-dependent values (this
way step functions can be used).

Between 4/2 and 4/16: Translated MPFAC and related procedures from IDL 
to f90. The w05sc module calls it so now the FAC field-aligned current 
is available as w05sc_fac(nmlonp1,nmlat) in the w05sc module (w05sc.F).

Made test runs of weimer05 with bz varying from -10 to +10. Made animations
of epot and fac for the group to evaluate, 
see /oreo/d/foster/tiegcm/weimer05/animations/w05sc
GIF animations were also saved in /toshi/ftp/pub/tgcm/tiegcm1-82/weimer05vs01.
Gang says weimer01 is not working, and weimer05 is ok, so can now remove
weimer01 option (but have not done this yet).

4/16/08:
Made netcdf data file w05sc.nc from .dat files (which were made from the
original idl .xdr save files). See /oreo/d/foster/weimer05/dat_to_nc.
The netcdf file is now read at 1st timestep by sub weimer05 (w05sc.F).
w05sc_rddat.F was eliminated, since the .dat files are no longer read.
The $TGCMDATA/*.dat files can be eliminated later, when nobody is using
the previous version (which was saved as a tar file in 
/oreo/d/foster/tiegcm/weimer05) for Liying, Wenbin, etc.

Copied weimer05 related source code used to translate from IDL to f90,
and making .dat and .nc data files, from /oreo/d/foster/weimer05 to
~/tgcm/weimer05 as backup.

Removed typedef inp from input.F, as it was never used.

Segregated "nodynamo" routines (called when DYNAMO=0) into nodynamo.F
(module nodynamo). This avoid confusion when working w/ the dynamo code.
Also removed Astrid's BOP documentation.

4/17/08:
Removed calls to ilink (util.F), so imported data files are not linked
from another location or to another name (see getfile, putms, output,
etc). Also, namelist read tempdir is now deprecated. Having it in the
input file will result in a non-fatal warning from input.F.

Increased mxlen_filename in input.F from 80 to 240.

Added "gale" section to Makefile and tgcm_config so now code builds
under ifort on gale.scd.ucar.edu, however it is mysteriously seg-faulting
at first call to rdgswm in gswm.F (sub getgswm). Print statement before
call to rdgswm shows, but first exec statement print in rdgswm does not
print. Asked Sid about this. Small test program works. Tried gdb, but
got almost nowhere. Will give this up for now. Identical code runs fine
on hao linux, blueice, lightning, tempest.

4/21/08:
Simplified scripts/Makefile, some minor changes to tgcm_config, and
tested on blueice, lightning, oreo, tempest, and gale. Had to make 
small change to use-assoc of mpi in hdif.F for tempest compiler.
Still have seg fault problem on gale as mentioned above.

Moved doc directory to ~foster/tiegcm/doc.

4/25/08:
Going back to HEELIS as default potential_model (input.F).

4/25/08:
Wenbin's fix to periodic points in duv.F, see comments and calls at 
end of sub glp.

Changed scripts/Mknamelist to use $TGCMDATA/FOSTER.tiegcm1-82.py2s004.nc
at 80,0,0 as SOURCE history in default namelist input file. Also set 
CALENDAR_ADVANCE=1.  When tiegcm1.9 is released, will put new source 
histories on $TGCMDATA for use by this version. 

Changed "w05sc" to "wei05sc" throughout, for better clarity.
This includes wei05sc_ncfile. Copied $TGCMDATA/w05sc.nc to wei05sc.nc.

Replaced ZBOT,ZTOP with  ZIBOT,ZITOP,ZMBOT,ZMTOP in src/defs.h so 
it can be used without being written by tgcm_config

Changed tgcm_version from tiegcm1-82 to tiegcm1-83 in params.F.

4/28/08: Preparing for cvs commit and tag as tiegcm1-83.
--------------------------------------------------------------------------------
