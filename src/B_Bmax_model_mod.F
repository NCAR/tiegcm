       module B_bmax_model_mod

         use common_model_mod, only: MMX,MXNMX,ITHMX,NQ,pi,
     |       magB0_apex,hr,fit_by_MLT
         implicit none
       
         logical :: value_dummy
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Arrays for fit coefficients:
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Number of fit coefficients for each mlat:
         integer :: B_Bmax_nfit
         ! Fit coefficients (dimension nmlat x nfit):
         real, allocatable, dimension(:,:) :: B_Bmax_b_Ed1,B_Bmax_b_Ed2 ! nmlat x nfit
         ! Interpolated fit coefficients (dimension nfit):
         real, allocatable, dimension(:) :: b_interp_Ed1,b_interp_Ed2
         ! Fitting functions (dimension nfit):
         real, allocatable, dimension(:) :: x
         ! Fit coefficients averaged over the pole (dimension nfit):
         real, allocatable, dimension(:) :: b_90_Ed1,b_90_Ed2
         ! Number of fit functions used by fit_data:
         integer, parameter :: B_Bmax_number_of_MLT_coeffs = 7,
     |       B_Bmax_number_of_Btrans_coeffs = 1,
     |       B_Bmax_number_of_imf_angle_coeffs = 3,
     |       B_Bmax_number_of_sinT_coeffs = 1
         ! Indices:
         integer :: imlat,ifit
         ! FAC:
         real :: Bmax_N_AO(NQ),Bmax_FAC_AO(-MMX:MMX,MXNMX,
     |       B_Bmax_number_of_Btrans_coeffs,
     |       B_Bmax_number_of_imf_angle_coeffs,
     |       B_Bmax_number_of_sinT_coeffs)
       
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Data smoothing:
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         logical :: do_smooth
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Results
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         real :: value, value_Ed1, value_Ed2
         logical :: value_found, fit_found
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Qgen variables
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         real ::  B_Bmax_AO(-MMX:MMX,MXNMX,
     |      B_Bmax_number_of_Btrans_coeffs,
     |      B_Bmax_number_of_imf_angle_coeffs,
     |      B_Bmax_number_of_sinT_coeffs)
         real :: B_Bmax_Q(NQ,0:ITHMX),B_Bmax_DQ(NQ,0:ITHMX)
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         ! Coeffmerge
         !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
         integer, parameter :: 
     |      B_Bmax_fit_by_Btrans = 0,
     |      B_Bmax_fit_by_imf_angle = 1,
     |      B_Bmax_fit_by_sinT = 0
       
       contains
       
         function find_MLT_function (index,MLT_in) result (MLT_fxn_out)
           integer :: index
           real :: MLT_in, MLT_fxn_out
       
           select case (index)
           case (0) 
              MLT_fxn_out = 1.
           case (1)
              MLT_fxn_out = 1.
           case (2)
              MLT_fxn_out = cos(pi*MLT_in/12.)
           case (3)
              MLT_fxn_out = sin(pi*MLT_in/12.)
           case (4)
              MLT_fxn_out = cos(pi*MLT_in/6.)
           case (5)
              MLT_fxn_out = sin(pi*MLT_in/6.)
           case (6)
              MLT_fxn_out = cos(pi*MLT_in/4.)
           case (7)
              MLT_fxn_out = sin(pi*MLT_in/4.)
           end select
         end function find_MLT_function
       
         function find_Btrans_function (index,Btrans_in) 
     |                result (Btrans_fxn_out)
           integer :: index
           real :: Btrans_in, Btrans_fxn_out
       
           select case (index)
           case (0) 
              Btrans_fxn_out = 1.
           case (1)
              Btrans_fxn_out = 1.
           case (2)
              Btrans_fxn_out = Btrans_in/5.2 - 1.
           case (3)
              Btrans_fxn_out = (Btrans_in/5.2 - 1.)**2
           end select
         end function find_Btrans_function
       
         function find_imf_angle_function (index,imf_angle_in) 
     |              result (imf_angle_fxn_out)
           integer :: index
           real :: imf_angle_in, imf_angle_fxn_out
       
           select case (index)
           case (0) 
              imf_angle_fxn_out = 1.
           case (1)
              imf_angle_fxn_out = 1.
           case (2)
              imf_angle_fxn_out = cos(imf_angle_in)
           case (3)
              imf_angle_fxn_out = sin(imf_angle_in)
           case (4)
              imf_angle_fxn_out = cos(2.*imf_angle_in)
           case (5)
              imf_angle_fxn_out = sin(2.*imf_angle_in)
           end select
         end function find_imf_angle_function
       
         function find_sinT_function (index,sinT_in)  
     |             result (sinT_fxn_out)
           integer :: index
           real :: sinT_in, sinT_fxn_out
       
           select case (index)
           case (0) 
              sinT_fxn_out = 1.
           case (1)
              sinT_fxn_out = 1.
           case (2)
              sinT_fxn_out = sinT_in
           case (3)
              sinT_fxn_out = sinT_in**2
           end select
         end function find_sinT_function
       
       end module B_bmax_model_mod
       
       !---------------------------------------------------------------------------
       !---------------------------------------------------------------------------
       
       module B_bmax_coeffmerge_mod
       
         ! Merged coefficients from dB_m and dB_r to one set
         ! of Fourier series coefficients
       
         ! This module file created 2006/10/30.
         ! with the following parameters:
         !   for 81249-83047 period 
         !   fit_by_Btrans = 0
         !   fit_by_imf_angle = 1
         !   fit_by_sinT = 0
         !   mlat_resolution = 2
       
         ! To use this module, include the statement
         !   use coeffmerge_mod
         ! and the subroutine call
         !   call fill_coeff_arrays
         ! in Fortran90 programs.
         ! 
         ! Compilation will be slow; a Makefile is suggested!
         implicit none
         save
         real,  dimension( 23, 21) :: dB_d1 
         real,  dimension( 23, 21) :: dB_d2 
         real,  dimension( 23) :: min_mlat,max_mlat!,average_mlat
       
       contains
       
         subroutine B_bmax_fill_coeff_arrays
       
           ! Fill dB_d1 arrays:
           dB_d1(  1,  1) =   0.8982    
           dB_d1(  1,  2) =    2.068    
           dB_d1(  1,  3) =   0.4371    
           dB_d1(  1,  4) =   -4.754    
           dB_d1(  1,  5) =   -11.27    
           dB_d1(  1,  6) =   0.8203    
           dB_d1(  1,  7) =   0.4132    
           dB_d1(  1,  8) =   0.7395    
           dB_d1(  1,  9) =  -0.7685    
           dB_d1(  1, 10) =   0.9928    
           dB_d1(  1, 11) =    2.179    
           dB_d1(  1, 12) =    1.071    
           dB_d1(  1, 13) =   0.5277    
           dB_d1(  1, 14) =   0.8230    
           dB_d1(  1, 15) =   0.1577    
           dB_d1(  1, 16) =   -3.325    
           dB_d1(  1, 17) =   -9.254    
           dB_d1(  1, 18) =  -0.2375E-01
           dB_d1(  1, 19) =    1.092    
           dB_d1(  1, 20) =   -1.044    
           dB_d1(  1, 21) =    3.168    
           dB_d1(  2,  1) =   -7.951    
           dB_d1(  2,  2) =   -7.691    
           dB_d1(  2,  3) =    3.000    
           dB_d1(  2,  4) =    9.946    
           dB_d1(  2,  5) =    4.352    
           dB_d1(  2,  6) =    1.544    
           dB_d1(  2,  7) =   0.7815    
           dB_d1(  2,  8) =    1.220    
           dB_d1(  2,  9) =   -3.111    
           dB_d1(  2, 10) =   -4.509    
           dB_d1(  2, 11) =   -4.609    
           dB_d1(  2, 12) =    2.759    
           dB_d1(  2, 13) =    5.318    
           dB_d1(  2, 14) =    8.326    
           dB_d1(  2, 15) =    4.520    
           dB_d1(  2, 16) =    4.646    
           dB_d1(  2, 17) =  -0.7640    
           dB_d1(  2, 18) =   -2.792    
           dB_d1(  2, 19) =    1.283    
           dB_d1(  2, 20) =    1.593    
           dB_d1(  2, 21) =   0.6750    
           dB_d1(  3,  1) =   -11.09    
           dB_d1(  3,  2) =   -10.64    
           dB_d1(  3,  3) =    2.793    
           dB_d1(  3,  4) =    13.22    
           dB_d1(  3,  5) =   -9.005    
           dB_d1(  3,  6) =    2.428    
           dB_d1(  3,  7) =    8.394    
           dB_d1(  3,  8) =    11.95    
           dB_d1(  3,  9) =   -6.956    
           dB_d1(  3, 10) =   -6.362    
           dB_d1(  3, 11) =   -5.476    
           dB_d1(  3, 12) =    2.447    
           dB_d1(  3, 13) =    13.19    
           dB_d1(  3, 14) =    13.91    
           dB_d1(  3, 15) =    5.026    
           dB_d1(  3, 16) =    6.703    
           dB_d1(  3, 17) =   -2.699    
           dB_d1(  3, 18) =   -6.409    
           dB_d1(  3, 19) =   -3.525    
           dB_d1(  3, 20) =   -14.82    
           dB_d1(  3, 21) =  -0.6540    
           dB_d1(  4,  1) =   -8.129    
           dB_d1(  4,  2) =   -9.950    
           dB_d1(  4,  3) =    6.302    
           dB_d1(  4,  4) =    2.970    
           dB_d1(  4,  5) =   -48.16    
           dB_d1(  4,  6) =    9.302    
           dB_d1(  4,  7) =    12.69    
           dB_d1(  4,  8) =    25.28    
           dB_d1(  4,  9) =   -8.621    
           dB_d1(  4, 10) =   -3.641    
           dB_d1(  4, 11) =    3.021    
           dB_d1(  4, 12) =    1.705    
           dB_d1(  4, 13) =    6.879    
           dB_d1(  4, 14) =    8.233    
           dB_d1(  4, 15) =    6.509    
           dB_d1(  4, 16) =    3.899    
           dB_d1(  4, 17) =   -7.685    
           dB_d1(  4, 18) =   -10.10    
           dB_d1(  4, 19) =   -5.847    
           dB_d1(  4, 20) =   -31.95    
           dB_d1(  4, 21) =    5.837    
           dB_d1(  5,  1) =   -13.57    
           dB_d1(  5,  2) =   -30.62    
           dB_d1(  5,  3) =    10.30    
           dB_d1(  5,  4) =   -2.385    
           dB_d1(  5,  5) =   -69.33    
           dB_d1(  5,  6) =    7.678    
           dB_d1(  5,  7) =    20.19    
           dB_d1(  5,  8) =    66.59    
           dB_d1(  5,  9) =   -17.93    
           dB_d1(  5, 10) =  -0.8550    
           dB_d1(  5, 11) =    14.83    
           dB_d1(  5, 12) =   -3.467    
           dB_d1(  5, 13) =    4.790    
           dB_d1(  5, 14) =   -3.235    
           dB_d1(  5, 15) =    7.251    
           dB_d1(  5, 16) =    9.139    
           dB_d1(  5, 17) =    8.295    
           dB_d1(  5, 18) =   -15.05    
           dB_d1(  5, 19) =   -21.94    
           dB_d1(  5, 20) =   -56.80    
           dB_d1(  5, 21) =    3.337    
           dB_d1(  6,  1) =   -20.19    
           dB_d1(  6,  2) =   -64.03    
           dB_d1(  6,  3) =   0.4945    
           dB_d1(  6,  4) =    1.908    
           dB_d1(  6,  5) =   -112.6    
           dB_d1(  6,  6) =    1.969    
           dB_d1(  6,  7) =    24.51    
           dB_d1(  6,  8) =    132.3    
           dB_d1(  6,  9) =   -12.73    
           dB_d1(  6, 10) =    8.805    
           dB_d1(  6, 11) =    42.47    
           dB_d1(  6, 12) =   -10.05    
           dB_d1(  6, 13) =    6.492    
           dB_d1(  6, 14) =    32.48    
           dB_d1(  6, 15) =    17.87    
           dB_d1(  6, 16) =    11.85    
           dB_d1(  6, 17) =    55.12    
           dB_d1(  6, 18) =   -13.90    
           dB_d1(  6, 19) =   -24.55    
           dB_d1(  6, 20) =   -54.16    
           dB_d1(  6, 21) =    12.22    
           dB_d1(  7,  1) =   -14.53    
           dB_d1(  7,  2) =   -77.21    
           dB_d1(  7,  3) =   -8.465    
           dB_d1(  7,  4) =    6.733    
           dB_d1(  7,  5) =   -134.1    
           dB_d1(  7,  6) =   -7.172    
           dB_d1(  7,  7) =    11.23    
           dB_d1(  7,  8) =    194.3    
           dB_d1(  7,  9) =    4.054    
           dB_d1(  7, 10) =    15.33    
           dB_d1(  7, 11) =    52.99    
           dB_d1(  7, 12) =   -13.35    
           dB_d1(  7, 13) =    2.404    
           dB_d1(  7, 14) =    48.72    
           dB_d1(  7, 15) =    38.75    
           dB_d1(  7, 16) =    14.45    
           dB_d1(  7, 17) =    70.69    
           dB_d1(  7, 18) =   -9.182    
           dB_d1(  7, 19) =   -25.19    
           dB_d1(  7, 20) =   -41.78    
           dB_d1(  7, 21) =    33.62    
           dB_d1(  8,  1) =   -19.48    
           dB_d1(  8,  2) =   -73.01    
           dB_d1(  8,  3) =   -15.73    
           dB_d1(  8,  4) =    13.45    
           dB_d1(  8,  5) =   -24.81    
           dB_d1(  8,  6) =   -17.90    
           dB_d1(  8,  7) =   -34.96    
           dB_d1(  8,  8) =    281.5    
           dB_d1(  8,  9) =    10.89    
           dB_d1(  8, 10) =    17.57    
           dB_d1(  8, 11) =    89.59    
           dB_d1(  8, 12) =   -32.15    
           dB_d1(  8, 13) =   -3.633    
           dB_d1(  8, 14) =    38.57    
           dB_d1(  8, 15) =    49.64    
           dB_d1(  8, 16) =    37.87    
           dB_d1(  8, 17) =    110.9    
           dB_d1(  8, 18) =   -8.432    
           dB_d1(  8, 19) =   -20.25    
           dB_d1(  8, 20) =   -4.450    
           dB_d1(  8, 21) =    39.35    
           dB_d1(  9,  1) =   -28.72    
           dB_d1(  9,  2) =   -13.75    
           dB_d1(  9,  3) =   -46.60    
           dB_d1(  9,  4) =   -29.13    
           dB_d1(  9,  5) =    123.9    
           dB_d1(  9,  6) =   -58.26    
           dB_d1(  9,  7) =   -170.3    
           dB_d1(  9,  8) =    271.9    
           dB_d1(  9,  9) =    27.06    
           dB_d1(  9, 10) =    10.67    
           dB_d1(  9, 11) =    117.6    
           dB_d1(  9, 12) =   -66.21    
           dB_d1(  9, 13) =   -38.28    
           dB_d1(  9, 14) =   -31.57    
           dB_d1(  9, 15) =    62.31    
           dB_d1(  9, 16) =    36.18    
           dB_d1(  9, 17) =    46.33    
           dB_d1(  9, 18) =   -46.33    
           dB_d1(  9, 19) =   -47.59    
           dB_d1(  9, 20) =   -58.10    
           dB_d1(  9, 21) =    55.28    
           dB_d1( 10,  1) =   -18.73    
           dB_d1( 10,  2) =   -28.07    
           dB_d1( 10,  3) =    4.072    
           dB_d1( 10,  4) =   -100.8    
           dB_d1( 10,  5) =    1.530    
           dB_d1( 10,  6) =    41.37    
           dB_d1( 10,  7) =   -275.2    
           dB_d1( 10,  8) =    317.4    
           dB_d1( 10,  9) =   -45.09    
           dB_d1( 10, 10) =   -21.78    
           dB_d1( 10, 11) =   -17.58    
           dB_d1( 10, 12) =   -8.258    
           dB_d1( 10, 13) =   -34.72    
           dB_d1( 10, 14) =   -55.97    
           dB_d1( 10, 15) =    6.415    
           dB_d1( 10, 16) =    61.32    
           dB_d1( 10, 17) =   -8.993    
           dB_d1( 10, 18) =   -21.35    
           dB_d1( 10, 19) =   -36.35    
           dB_d1( 10, 20) =   -94.30    
           dB_d1( 10, 21) =    41.88    
           dB_d1( 11,  1) =   -35.76    
           dB_d1( 11,  2) =   -13.48    
           dB_d1( 11,  3) =   -9.135    
           dB_d1( 11,  4) =   -147.0    
           dB_d1( 11,  5) =   -60.08    
           dB_d1( 11,  6) =    22.65    
           dB_d1( 11,  7) =   -267.1    
           dB_d1( 11,  8) =    296.7    
           dB_d1( 11,  9) =   -59.13    
           dB_d1( 11, 10) =    15.83    
           dB_d1( 11, 11) =   -25.50    
           dB_d1( 11, 12) =   -21.80    
           dB_d1( 11, 13) =   -12.64    
           dB_d1( 11, 14) =   -36.73    
           dB_d1( 11, 15) =   -28.78    
           dB_d1( 11, 16) =    23.27    
           dB_d1( 11, 17) =   -105.5    
           dB_d1( 11, 18) =    8.568    
           dB_d1( 11, 19) =   -27.70    
           dB_d1( 11, 20) =   -84.26    
           dB_d1( 11, 21) =    40.19    
           dB_d1( 12,  1) =   -75.26    
           dB_d1( 12,  2) =    23.90    
           dB_d1( 12,  3) =   -10.25    
           dB_d1( 12,  4) =   -197.4    
           dB_d1( 12,  5) =   -111.8    
           dB_d1( 12,  6) =    20.83    
           dB_d1( 12,  7) =   -199.7    
           dB_d1( 12,  8) =    234.6    
           dB_d1( 12,  9) =    50.61    
           dB_d1( 12, 10) =    40.74    
           dB_d1( 12, 11) =   -1.085    
           dB_d1( 12, 12) =   -27.82    
           dB_d1( 12, 13) =   -18.55    
           dB_d1( 12, 14) =   -76.10    
           dB_d1( 12, 15) =   -61.45    
           dB_d1( 12, 16) =   -3.555    
           dB_d1( 12, 17) =   -109.8    
           dB_d1( 12, 18) =    33.79    
           dB_d1( 12, 19) =   -55.25    
           dB_d1( 12, 20) =   -150.4    
           dB_d1( 12, 21) =    45.44    
           dB_d1( 13,  1) =   -94.61    
           dB_d1( 13,  2) =    9.045    
           dB_d1( 13,  3) =    87.00    
           dB_d1( 13,  4) =   -136.6    
           dB_d1( 13,  5) =   -169.0    
           dB_d1( 13,  6) =    5.160    
           dB_d1( 13,  7) =   -290.5    
           dB_d1( 13,  8) =   -255.4    
           dB_d1( 13,  9) =    39.92    
           dB_d1( 13, 10) =    47.58    
           dB_d1( 13, 11) =   -62.72    
           dB_d1( 13, 12) =    45.31    
           dB_d1( 13, 13) =   -22.32    
           dB_d1( 13, 14) =   -47.46    
           dB_d1( 13, 15) =   -35.27    
           dB_d1( 13, 16) =   -62.01    
           dB_d1( 13, 17) =   -89.68    
           dB_d1( 13, 18) =    30.59    
           dB_d1( 13, 19) =   -17.70    
           dB_d1( 13, 20) =   -52.77    
           dB_d1( 13, 21) =    8.180    
           dB_d1( 14,  1) =   -52.79    
           dB_d1( 14,  2) =    54.63    
           dB_d1( 14,  3) =    159.5    
           dB_d1( 14,  4) =   -58.67    
           dB_d1( 14,  5) =   -126.3    
           dB_d1( 14,  6) =   -23.01    
           dB_d1( 14,  7) =   -98.75    
           dB_d1( 14,  8) =   -285.7    
           dB_d1( 14,  9) =    66.92    
           dB_d1( 14, 10) =    35.85    
           dB_d1( 14, 11) =    6.910    
           dB_d1( 14, 12) =    54.00    
           dB_d1( 14, 13) =    41.16    
           dB_d1( 14, 14) =    101.7    
           dB_d1( 14, 15) =    10.34    
           dB_d1( 14, 16) =   -62.29    
           dB_d1( 14, 17) =   -17.24    
           dB_d1( 14, 18) =   -16.90    
           dB_d1( 14, 19) =   -26.45    
           dB_d1( 14, 20) =   -71.91    
           dB_d1( 14, 21) =   -16.13    
           dB_d1( 15,  1) =   -40.71    
           dB_d1( 15,  2) =    16.49    
           dB_d1( 15,  3) =    179.0    
           dB_d1( 15,  4) =    9.775    
           dB_d1( 15,  5) =   -112.8    
           dB_d1( 15,  6) =   -53.21    
           dB_d1( 15,  7) =    33.56    
           dB_d1( 15,  8) =   -273.6    
           dB_d1( 15,  9) =    104.7    
           dB_d1( 15, 10) =    19.89    
           dB_d1( 15, 11) =    74.77    
           dB_d1( 15, 12) =    49.35    
           dB_d1( 15, 13) =    59.18    
           dB_d1( 15, 14) =    106.5    
           dB_d1( 15, 15) =   -13.73    
           dB_d1( 15, 16) =   -39.76    
           dB_d1( 15, 17) =   -5.210    
           dB_d1( 15, 18) =   -48.24    
           dB_d1( 15, 19) =   -82.06    
           dB_d1( 15, 20) =   -121.8    
           dB_d1( 15, 21) =   -7.675    
           dB_d1( 16,  1) =   -4.760    
           dB_d1( 16,  2) =   -8.500    
           dB_d1( 16,  3) =    204.8    
           dB_d1( 16,  4) =   -44.98    
           dB_d1( 16,  5) =   -87.66    
           dB_d1( 16,  6) =   -128.3    
           dB_d1( 16,  7) =    26.00    
           dB_d1( 16,  8) =   -331.5    
           dB_d1( 16,  9) =    92.17    
           dB_d1( 16, 10) =    37.47    
           dB_d1( 16, 11) =    96.40    
           dB_d1( 16, 12) =    68.95    
           dB_d1( 16, 13) =    108.4    
           dB_d1( 16, 14) =    153.6    
           dB_d1( 16, 15) =   -6.640    
           dB_d1( 16, 16) =   -44.62    
           dB_d1( 16, 17) =   -20.39    
           dB_d1( 16, 18) =   -60.25    
           dB_d1( 16, 19) =   -144.0    
           dB_d1( 16, 20) =   -211.7    
           dB_d1( 16, 21) =   -14.30    
           dB_d1( 17,  1) =    24.57    
           dB_d1( 17,  2) =    38.71    
           dB_d1( 17,  3) =    187.4    
           dB_d1( 17,  4) =   -2.615    
           dB_d1( 17,  5) =   -89.50    
           dB_d1( 17,  6) =   -56.57    
           dB_d1( 17,  7) =    84.42    
           dB_d1( 17,  8) =   -251.9    
           dB_d1( 17,  9) =    55.07    
           dB_d1( 17, 10) =    33.34    
           dB_d1( 17, 11) =    104.9    
           dB_d1( 17, 12) =    40.30    
           dB_d1( 17, 13) =    84.11    
           dB_d1( 17, 14) =    122.9    
           dB_d1( 17, 15) =  -0.5050    
           dB_d1( 17, 16) =    1.855    
           dB_d1( 17, 17) =    31.04    
           dB_d1( 17, 18) =   -18.76    
           dB_d1( 17, 19) =   -91.52    
           dB_d1( 17, 20) =   -114.1    
           dB_d1( 17, 21) =    9.635    
           dB_d1( 18,  1) =    11.47    
           dB_d1( 18,  2) =    6.755    
           dB_d1( 18,  3) =    130.3    
           dB_d1( 18,  4) =    54.99    
           dB_d1( 18,  5) =    6.924    
           dB_d1( 18,  6) =   -22.64    
           dB_d1( 18,  7) =    122.6    
           dB_d1( 18,  8) =   -221.5    
           dB_d1( 18,  9) =    19.45    
           dB_d1( 18, 10) =   -7.036    
           dB_d1( 18, 11) =    61.92    
           dB_d1( 18, 12) =    20.00    
           dB_d1( 18, 13) =    34.63    
           dB_d1( 18, 14) =    60.33    
           dB_d1( 18, 15) =   -6.745    
           dB_d1( 18, 16) =    12.59    
           dB_d1( 18, 17) =    19.07    
           dB_d1( 18, 18) =    8.260    
           dB_d1( 18, 19) =   -69.12    
           dB_d1( 18, 20) =   -57.11    
           dB_d1( 18, 21) =    28.19    
           dB_d1( 19,  1) =    9.965    
           dB_d1( 19,  2) =    119.8    
           dB_d1( 19,  3) =    76.91    
           dB_d1( 19,  4) =    108.3    
           dB_d1( 19,  5) =    90.58    
           dB_d1( 19,  6) =    40.16    
           dB_d1( 19,  7) =    83.07    
           dB_d1( 19,  8) =   -178.6    
           dB_d1( 19,  9) =    17.22    
           dB_d1( 19, 10) =   -27.33    
           dB_d1( 19, 11) =  -0.4000    
           dB_d1( 19, 12) =    1.200    
           dB_d1( 19, 13) =    4.855    
           dB_d1( 19, 14) =    41.18    
           dB_d1( 19, 15) =   -18.79    
           dB_d1( 19, 16) =    5.740    
           dB_d1( 19, 17) =    36.47    
           dB_d1( 19, 18) =  -0.4250    
           dB_d1( 19, 19) =   -8.675    
           dB_d1( 19, 20) =   -67.50    
           dB_d1( 19, 21) =    2.585    
           dB_d1( 20,  1) =   -25.89    
           dB_d1( 20,  2) =    7.210    
           dB_d1( 20,  3) =    22.56    
           dB_d1( 20,  4) =    84.62    
           dB_d1( 20,  5) =    15.75    
           dB_d1( 20,  6) =    78.74    
           dB_d1( 20,  7) =    170.8    
           dB_d1( 20,  8) =   -117.6    
           dB_d1( 20,  9) =    53.54    
           dB_d1( 20, 10) =   -25.21    
           dB_d1( 20, 11) =    26.63    
           dB_d1( 20, 12) =    11.38    
           dB_d1( 20, 13) =   -5.385    
           dB_d1( 20, 14) =   -12.48    
           dB_d1( 20, 15) =    28.64    
           dB_d1( 20, 16) =   -18.34    
           dB_d1( 20, 17) =    12.34    
           dB_d1( 20, 18) =   -26.43    
           dB_d1( 20, 19) =   -22.97    
           dB_d1( 20, 20) =   -28.49    
           dB_d1( 20, 21) =   -28.61    
           dB_d1( 21,  1) =   -45.58    
           dB_d1( 21,  2) =   -89.55    
           dB_d1( 21,  3) =   -8.591    
           dB_d1( 21,  4) =   -29.85    
           dB_d1( 21,  5) =   -100.4    
           dB_d1( 21,  6) =    104.9    
           dB_d1( 21,  7) =    226.7    
           dB_d1( 21,  8) =   -34.26    
           dB_d1( 21,  9) =    82.35    
           dB_d1( 21, 10) =   -43.18    
           dB_d1( 21, 11) =   -25.15    
           dB_d1( 21, 12) =   -6.639    
           dB_d1( 21, 13) =    35.85    
           dB_d1( 21, 14) =    37.61    
           dB_d1( 21, 15) =    33.58    
           dB_d1( 21, 16) =   -34.12    
           dB_d1( 21, 17) =    23.42    
           dB_d1( 21, 18) =  -0.4150    
           dB_d1( 21, 19) =    29.83    
           dB_d1( 21, 20) =    133.8    
           dB_d1( 21, 21) =    35.17    
           dB_d1( 22,  1) =   -40.15    
           dB_d1( 22,  2) =   -189.9    
           dB_d1( 22,  3) =    112.1    
           dB_d1( 22,  4) =   -62.39    
           dB_d1( 22,  5) =   -85.32    
           dB_d1( 22,  6) =   -18.60    
           dB_d1( 22,  7) =   -70.04    
           dB_d1( 22,  8) =   -479.7    
           dB_d1( 22,  9) =    96.26    
           dB_d1( 22, 10) =   -315.0    
           dB_d1( 22, 11) =   -722.3    
           dB_d1( 22, 12) =    91.51    
           dB_d1( 22, 13) =    91.60    
           dB_d1( 22, 14) =    260.0    
           dB_d1( 22, 15) =   -17.74    
           dB_d1( 22, 16) =    13.60    
           dB_d1( 22, 17) =    59.63    
           dB_d1( 22, 18) =   -12.66    
           dB_d1( 22, 19) =    74.50    
           dB_d1( 22, 20) =    79.04    
           dB_d1( 22, 21) =    103.2    
           dB_d1( 23,  1) =    0.000    
           dB_d1( 23,  2) =    0.000    
           dB_d1( 23,  3) =    0.000    
           dB_d1( 23,  4) =   0.1000E+18
           dB_d1( 23,  5) =   0.1000E+18
           dB_d1( 23,  6) =   0.1000E+18
           dB_d1( 23,  7) =    0.000    
           dB_d1( 23,  8) =    0.000    
           dB_d1( 23,  9) =    0.000    
           dB_d1( 23, 10) =   0.1000E+18
           dB_d1( 23, 11) =   0.1000E+18
           dB_d1( 23, 12) =   0.1000E+18
           dB_d1( 23, 13) =    0.000    
           dB_d1( 23, 14) =    0.000    
           dB_d1( 23, 15) =    0.000    
           dB_d1( 23, 16) =   0.1000E+18
           dB_d1( 23, 17) =   0.1000E+18
           dB_d1( 23, 18) =   0.1000E+18
           dB_d1( 23, 19) =    0.000    
           dB_d1( 23, 20) =    0.000    
           dB_d1( 23, 21) =    0.000    
       
           ! Fill dB_d2 arrays:
           dB_d2(  1,  1) =   -1.125    
           dB_d2(  1,  2) =   -2.590    
           dB_d2(  1,  3) =  -0.9612    
           dB_d2(  1,  4) =   -1.001    
           dB_d2(  1,  5) =   -7.651    
           dB_d2(  1,  6) =    1.939    
           dB_d2(  1,  7) =   -2.286    
           dB_d2(  1,  8) =   -7.782    
           dB_d2(  1,  9) =   0.3069    
           dB_d2(  1, 10) =  -0.5277    
           dB_d2(  1, 11) =  -0.8230    
           dB_d2(  1, 12) =  -0.1577    
           dB_d2(  1, 13) =   0.9928    
           dB_d2(  1, 14) =    2.179    
           dB_d2(  1, 15) =    1.071    
           dB_d2(  1, 16) =   -1.092    
           dB_d2(  1, 17) =    1.044    
           dB_d2(  1, 18) =   -3.168    
           dB_d2(  1, 19) =   -3.325    
           dB_d2(  1, 20) =   -9.254    
           dB_d2(  1, 21) =  -0.2375E-01
           dB_d2(  2,  1) =   -8.182    
           dB_d2(  2,  2) =   -16.76    
           dB_d2(  2,  3) =   0.1520    
           dB_d2(  2,  4) =   -5.443    
           dB_d2(  2,  5) =   -8.414    
           dB_d2(  2,  6) =   -3.009    
           dB_d2(  2,  7) =   -2.582    
           dB_d2(  2,  8) =   -1.438    
           dB_d2(  2,  9) =   -7.398    
           dB_d2(  2, 10) =   -5.318    
           dB_d2(  2, 11) =   -8.326    
           dB_d2(  2, 12) =   -4.520    
           dB_d2(  2, 13) =   -4.509    
           dB_d2(  2, 14) =   -4.609    
           dB_d2(  2, 15) =    2.759    
           dB_d2(  2, 16) =   -1.283    
           dB_d2(  2, 17) =   -1.593    
           dB_d2(  2, 18) =  -0.6750    
           dB_d2(  2, 19) =    4.646    
           dB_d2(  2, 20) =  -0.7640    
           dB_d2(  2, 21) =   -2.792    
           dB_d2(  3,  1) =   -4.898    
           dB_d2(  3,  2) =   -18.56    
           dB_d2(  3,  3) =    3.105    
           dB_d2(  3,  4) =   -11.05    
           dB_d2(  3,  5) =   -30.23    
           dB_d2(  3,  6) =   -3.268    
           dB_d2(  3,  7) =   -3.930    
           dB_d2(  3,  8) =    1.761    
           dB_d2(  3,  9) =   -8.594    
           dB_d2(  3, 10) =   -13.19    
           dB_d2(  3, 11) =   -13.91    
           dB_d2(  3, 12) =   -5.026    
           dB_d2(  3, 13) =   -6.362    
           dB_d2(  3, 14) =   -5.476    
           dB_d2(  3, 15) =    2.447    
           dB_d2(  3, 16) =    3.525    
           dB_d2(  3, 17) =    14.82    
           dB_d2(  3, 18) =   0.6540    
           dB_d2(  3, 19) =    6.703    
           dB_d2(  3, 20) =   -2.699    
           dB_d2(  3, 21) =   -6.409    
           dB_d2(  4,  1) =   -3.231    
           dB_d2(  4,  2) =   -9.137    
           dB_d2(  4,  3) =   0.3700    
           dB_d2(  4,  4) =   -21.97    
           dB_d2(  4,  5) =   -47.66    
           dB_d2(  4,  6) =    2.045    
           dB_d2(  4,  7) =   -6.484    
           dB_d2(  4,  8) =    7.685    
           dB_d2(  4,  9) =   -9.959    
           dB_d2(  4, 10) =   -6.879    
           dB_d2(  4, 11) =   -8.233    
           dB_d2(  4, 12) =   -6.509    
           dB_d2(  4, 13) =   -3.641    
           dB_d2(  4, 14) =    3.021    
           dB_d2(  4, 15) =    1.705    
           dB_d2(  4, 16) =    5.847    
           dB_d2(  4, 17) =    31.95    
           dB_d2(  4, 18) =   -5.837    
           dB_d2(  4, 19) =    3.899    
           dB_d2(  4, 20) =   -7.685    
           dB_d2(  4, 21) =   -10.10    
           dB_d2(  5,  1) =   -4.030    
           dB_d2(  5,  2) =   -15.45    
           dB_d2(  5,  3) =    7.979    
           dB_d2(  5,  4) =   -21.65    
           dB_d2(  5,  5) =   -28.35    
           dB_d2(  5,  6) =    3.187    
           dB_d2(  5,  7) =    2.776    
           dB_d2(  5,  8) =    62.82    
           dB_d2(  5,  9) =   -14.96    
           dB_d2(  5, 10) =   -4.790    
           dB_d2(  5, 11) =    3.235    
           dB_d2(  5, 12) =   -7.251    
           dB_d2(  5, 13) =  -0.8550    
           dB_d2(  5, 14) =    14.83    
           dB_d2(  5, 15) =   -3.467    
           dB_d2(  5, 16) =    21.94    
           dB_d2(  5, 17) =    56.80    
           dB_d2(  5, 18) =   -3.337    
           dB_d2(  5, 19) =    9.139    
           dB_d2(  5, 20) =    8.295    
           dB_d2(  5, 21) =   -15.05    
           dB_d2(  6,  1) =   -4.358    
           dB_d2(  6,  2) =   -38.97    
           dB_d2(  6,  3) =    13.62    
           dB_d2(  6,  4) =   -10.81    
           dB_d2(  6,  5) =    14.01    
           dB_d2(  6,  6) =    9.690    
           dB_d2(  6,  7) =   -14.62    
           dB_d2(  6,  8) =    97.20    
           dB_d2(  6,  9) =   -21.88    
           dB_d2(  6, 10) =   -6.492    
           dB_d2(  6, 11) =   -32.48    
           dB_d2(  6, 12) =   -17.87    
           dB_d2(  6, 13) =    8.805    
           dB_d2(  6, 14) =    42.47    
           dB_d2(  6, 15) =   -10.05    
           dB_d2(  6, 16) =    24.55    
           dB_d2(  6, 17) =    54.16    
           dB_d2(  6, 18) =   -12.22    
           dB_d2(  6, 19) =    11.85    
           dB_d2(  6, 20) =    55.12    
           dB_d2(  6, 21) =   -13.90    
           dB_d2(  7,  1) =  -0.1685    
           dB_d2(  7,  2) =   -47.95    
           dB_d2(  7,  3) =    10.09    
           dB_d2(  7,  4) =   -16.72    
           dB_d2(  7,  5) =    29.36    
           dB_d2(  7,  6) =    8.476    
           dB_d2(  7,  7) =   -39.29    
           dB_d2(  7,  8) =    119.7    
           dB_d2(  7,  9) =   -26.25    
           dB_d2(  7, 10) =   -2.404    
           dB_d2(  7, 11) =   -48.72    
           dB_d2(  7, 12) =   -38.75    
           dB_d2(  7, 13) =    15.33    
           dB_d2(  7, 14) =    52.99    
           dB_d2(  7, 15) =   -13.35    
           dB_d2(  7, 16) =    25.19    
           dB_d2(  7, 17) =    41.78    
           dB_d2(  7, 18) =   -33.62    
           dB_d2(  7, 19) =    14.45    
           dB_d2(  7, 20) =    70.69    
           dB_d2(  7, 21) =   -9.182    
           dB_d2(  8,  1) =   0.4800    
           dB_d2(  8,  2) =   -21.77    
           dB_d2(  8,  3) =    14.27    
           dB_d2(  8,  4) =   -37.76    
           dB_d2(  8,  5) =    63.15    
           dB_d2(  8,  6) =    6.002    
           dB_d2(  8,  7) =   -65.69    
           dB_d2(  8,  8) =    96.51    
           dB_d2(  8,  9) =   -24.66    
           dB_d2(  8, 10) =    3.633    
           dB_d2(  8, 11) =   -38.57    
           dB_d2(  8, 12) =   -49.64    
           dB_d2(  8, 13) =    17.57    
           dB_d2(  8, 14) =    89.59    
           dB_d2(  8, 15) =   -32.15    
           dB_d2(  8, 16) =    20.25    
           dB_d2(  8, 17) =    4.450    
           dB_d2(  8, 18) =   -39.35    
           dB_d2(  8, 19) =    37.87    
           dB_d2(  8, 20) =    110.9    
           dB_d2(  8, 21) =   -8.432    
           dB_d2(  9,  1) =    10.35    
           dB_d2(  9,  2) =    34.45    
           dB_d2(  9,  3) =    11.04    
           dB_d2(  9,  4) =   -75.96    
           dB_d2(  9,  5) =    53.70    
           dB_d2(  9,  6) =    5.505    
           dB_d2(  9,  7) =   -85.81    
           dB_d2(  9,  8) =    60.58    
           dB_d2(  9,  9) =   -29.56    
           dB_d2(  9, 10) =    38.28    
           dB_d2(  9, 11) =    31.57    
           dB_d2(  9, 12) =   -62.31    
           dB_d2(  9, 13) =    10.67    
           dB_d2(  9, 14) =    117.6    
           dB_d2(  9, 15) =   -66.21    
           dB_d2(  9, 16) =    47.59    
           dB_d2(  9, 17) =    58.10    
           dB_d2(  9, 18) =   -55.28    
           dB_d2(  9, 19) =    36.18    
           dB_d2(  9, 20) =    46.33    
           dB_d2(  9, 21) =   -46.33    
           dB_d2( 10,  1) =   0.2500E-01
           dB_d2( 10,  2) =    12.18    
           dB_d2( 10,  3) =    26.63    
           dB_d2( 10,  4) =   -109.5    
           dB_d2( 10,  5) =   -3.205    
           dB_d2( 10,  6) =    26.37    
           dB_d2( 10,  7) =   -94.28    
           dB_d2( 10,  8) =   -10.49    
           dB_d2( 10,  9) =   -22.63    
           dB_d2( 10, 10) =    34.72    
           dB_d2( 10, 11) =    55.97    
           dB_d2( 10, 12) =   -6.415    
           dB_d2( 10, 13) =   -21.78    
           dB_d2( 10, 14) =   -17.58    
           dB_d2( 10, 15) =   -8.258    
           dB_d2( 10, 16) =    36.35    
           dB_d2( 10, 17) =    94.30    
           dB_d2( 10, 18) =   -41.88    
           dB_d2( 10, 19) =    61.32    
           dB_d2( 10, 20) =   -8.993    
           dB_d2( 10, 21) =   -21.35    
           dB_d2( 11,  1) =    24.73    
           dB_d2( 11,  2) =    96.88    
           dB_d2( 11,  3) =   -11.90    
           dB_d2( 11,  4) =   -109.7    
           dB_d2( 11,  5) =    16.74    
           dB_d2( 11,  6) =    28.35    
           dB_d2( 11,  7) =   -74.03    
           dB_d2( 11,  8) =   -15.82    
           dB_d2( 11,  9) =    15.69    
           dB_d2( 11, 10) =    12.64    
           dB_d2( 11, 11) =    36.73    
           dB_d2( 11, 12) =    28.78    
           dB_d2( 11, 13) =    15.83    
           dB_d2( 11, 14) =   -25.50    
           dB_d2( 11, 15) =   -21.80    
           dB_d2( 11, 16) =    27.70    
           dB_d2( 11, 17) =    84.26    
           dB_d2( 11, 18) =   -40.19    
           dB_d2( 11, 19) =    23.27    
           dB_d2( 11, 20) =   -105.5    
           dB_d2( 11, 21) =    8.568    
           dB_d2( 12,  1) =   -7.200    
           dB_d2( 12,  2) =    43.60    
           dB_d2( 12,  3) =   -36.25    
           dB_d2( 12,  4) =   -152.0    
           dB_d2( 12,  5) =   -17.99    
           dB_d2( 12,  6) =    41.93    
           dB_d2( 12,  7) =   -85.18    
           dB_d2( 12,  8) =   -129.6    
           dB_d2( 12,  9) =    42.44    
           dB_d2( 12, 10) =    18.55    
           dB_d2( 12, 11) =    76.10    
           dB_d2( 12, 12) =    61.45    
           dB_d2( 12, 13) =    40.74    
           dB_d2( 12, 14) =   -1.085    
           dB_d2( 12, 15) =   -27.82    
           dB_d2( 12, 16) =    55.25    
           dB_d2( 12, 17) =    150.4    
           dB_d2( 12, 18) =   -45.44    
           dB_d2( 12, 19) =   -3.555    
           dB_d2( 12, 20) =   -109.8    
           dB_d2( 12, 21) =    33.79    
           dB_d2( 13,  1) =    7.505    
           dB_d2( 13,  2) =    12.55    
           dB_d2( 13,  3) =   -8.550    
           dB_d2( 13,  4) =   -216.7    
           dB_d2( 13,  5) =    6.970    
           dB_d2( 13,  6) =    45.26    
           dB_d2( 13,  7) =   -63.79    
           dB_d2( 13,  8) =   -67.79    
           dB_d2( 13,  9) =    48.92    
           dB_d2( 13, 10) =    22.32    
           dB_d2( 13, 11) =    47.46    
           dB_d2( 13, 12) =    35.27    
           dB_d2( 13, 13) =    47.58    
           dB_d2( 13, 14) =   -62.72    
           dB_d2( 13, 15) =    45.31    
           dB_d2( 13, 16) =    17.70    
           dB_d2( 13, 17) =    52.77    
           dB_d2( 13, 18) =   -8.180    
           dB_d2( 13, 19) =   -62.01    
           dB_d2( 13, 20) =   -89.68    
           dB_d2( 13, 21) =    30.59    
           dB_d2( 14,  1) =    10.28    
           dB_d2( 14,  2) =    17.59    
           dB_d2( 14,  3) =    46.65    
           dB_d2( 14,  4) =   -178.9    
           dB_d2( 14,  5) =    26.72    
           dB_d2( 14,  6) =   -8.805    
           dB_d2( 14,  7) =    10.03    
           dB_d2( 14,  8) =   -5.905    
           dB_d2( 14,  9) =    32.48    
           dB_d2( 14, 10) =   -41.16    
           dB_d2( 14, 11) =   -101.7    
           dB_d2( 14, 12) =   -10.34    
           dB_d2( 14, 13) =    35.85    
           dB_d2( 14, 14) =    6.910    
           dB_d2( 14, 15) =    54.00    
           dB_d2( 14, 16) =    26.45    
           dB_d2( 14, 17) =    71.91    
           dB_d2( 14, 18) =    16.13    
           dB_d2( 14, 19) =   -62.29    
           dB_d2( 14, 20) =   -17.24    
           dB_d2( 14, 21) =   -16.90    
           dB_d2( 15,  1) =   -1.430    
           dB_d2( 15,  2) =    4.100    
           dB_d2( 15,  3) =    63.85    
           dB_d2( 15,  4) =   -178.0    
           dB_d2( 15,  5) =    30.36    
           dB_d2( 15,  6) =   -27.34    
           dB_d2( 15,  7) =    88.27    
           dB_d2( 15,  8) =    4.240    
           dB_d2( 15,  9) =    48.21    
           dB_d2( 15, 10) =   -59.18    
           dB_d2( 15, 11) =   -106.5    
           dB_d2( 15, 12) =    13.73    
           dB_d2( 15, 13) =    19.89    
           dB_d2( 15, 14) =    74.77    
           dB_d2( 15, 15) =    49.35    
           dB_d2( 15, 16) =    82.06    
           dB_d2( 15, 17) =    121.8    
           dB_d2( 15, 18) =    7.675    
           dB_d2( 15, 19) =   -39.76    
           dB_d2( 15, 20) =   -5.210    
           dB_d2( 15, 21) =   -48.24    
           dB_d2( 16,  1) =   -10.57    
           dB_d2( 16,  2) =    22.15    
           dB_d2( 16,  3) =    54.56    
           dB_d2( 16,  4) =   -201.6    
           dB_d2( 16,  5) =   -2.720    
           dB_d2( 16,  6) =   -30.72    
           dB_d2( 16,  7) =    124.4    
           dB_d2( 16,  8) =    50.16    
           dB_d2( 16,  9) =    66.95    
           dB_d2( 16, 10) =   -108.4    
           dB_d2( 16, 11) =   -153.6    
           dB_d2( 16, 12) =    6.640    
           dB_d2( 16, 13) =    37.47    
           dB_d2( 16, 14) =    96.40    
           dB_d2( 16, 15) =    68.95    
           dB_d2( 16, 16) =    144.0    
           dB_d2( 16, 17) =    211.7    
           dB_d2( 16, 18) =    14.30    
           dB_d2( 16, 19) =   -44.62    
           dB_d2( 16, 20) =   -20.39    
           dB_d2( 16, 21) =   -60.25    
           dB_d2( 17,  1) =   -9.985    
           dB_d2( 17,  2) =    33.06    
           dB_d2( 17,  3) =    68.24    
           dB_d2( 17,  4) =   -221.2    
           dB_d2( 17,  5) =    36.09    
           dB_d2( 17,  6) =   -43.37    
           dB_d2( 17,  7) =    90.51    
           dB_d2( 17,  8) =    29.28    
           dB_d2( 17,  9) =    62.24    
           dB_d2( 17, 10) =   -84.11    
           dB_d2( 17, 11) =   -122.9    
           dB_d2( 17, 12) =   0.5050    
           dB_d2( 17, 13) =    33.34    
           dB_d2( 17, 14) =    104.9    
           dB_d2( 17, 15) =    40.30    
           dB_d2( 17, 16) =    91.52    
           dB_d2( 17, 17) =    114.1    
           dB_d2( 17, 18) =   -9.635    
           dB_d2( 17, 19) =    1.855    
           dB_d2( 17, 20) =    31.04    
           dB_d2( 17, 21) =   -18.76    
           dB_d2( 18,  1) =   -15.62    
           dB_d2( 18,  2) =    12.09    
           dB_d2( 18,  3) =    56.78    
           dB_d2( 18,  4) =   -230.2    
           dB_d2( 18,  5) =    96.51    
           dB_d2( 18,  6) =   -42.73    
           dB_d2( 18,  7) =    90.25    
           dB_d2( 18,  8) =   -4.056    
           dB_d2( 18,  9) =    82.28    
           dB_d2( 18, 10) =   -34.63    
           dB_d2( 18, 11) =   -60.33    
           dB_d2( 18, 12) =    6.745    
           dB_d2( 18, 13) =   -7.036    
           dB_d2( 18, 14) =    61.92    
           dB_d2( 18, 15) =    20.00    
           dB_d2( 18, 16) =    69.12    
           dB_d2( 18, 17) =    57.11    
           dB_d2( 18, 18) =   -28.19    
           dB_d2( 18, 19) =    12.59    
           dB_d2( 18, 20) =    19.07    
           dB_d2( 18, 21) =    8.260    
           dB_d2( 19,  1) =    30.53    
           dB_d2( 19,  2) =    43.61    
           dB_d2( 19,  3) =    27.99    
           dB_d2( 19,  4) =   -254.3    
           dB_d2( 19,  5) =    38.20    
           dB_d2( 19,  6) =   -79.40    
           dB_d2( 19,  7) =    57.21    
           dB_d2( 19,  8) =   -44.68    
           dB_d2( 19,  9) =    103.2    
           dB_d2( 19, 10) =   -4.855    
           dB_d2( 19, 11) =   -41.18    
           dB_d2( 19, 12) =    18.79    
           dB_d2( 19, 13) =   -27.33    
           dB_d2( 19, 14) =  -0.4000    
           dB_d2( 19, 15) =    1.200    
           dB_d2( 19, 16) =    8.675    
           dB_d2( 19, 17) =    67.50    
           dB_d2( 19, 18) =   -2.585    
           dB_d2( 19, 19) =    5.740    
           dB_d2( 19, 20) =    36.47    
           dB_d2( 19, 21) =  -0.4250    
           dB_d2( 20,  1) =   -13.37    
           dB_d2( 20,  2) =   -36.68    
           dB_d2( 20,  3) =    16.93    
           dB_d2( 20,  4) =   -198.4    
           dB_d2( 20,  5) =    138.2    
           dB_d2( 20,  6) =   -63.48    
           dB_d2( 20,  7) =    16.98    
           dB_d2( 20,  8) =   -112.0    
           dB_d2( 20,  9) =    138.9    
           dB_d2( 20, 10) =    5.385    
           dB_d2( 20, 11) =    12.48    
           dB_d2( 20, 12) =   -28.64    
           dB_d2( 20, 13) =   -25.21    
           dB_d2( 20, 14) =    26.63    
           dB_d2( 20, 15) =    11.38    
           dB_d2( 20, 16) =    22.97    
           dB_d2( 20, 17) =    28.49    
           dB_d2( 20, 18) =    28.61    
           dB_d2( 20, 19) =   -18.34    
           dB_d2( 20, 20) =    12.34    
           dB_d2( 20, 21) =   -26.43    
           dB_d2( 21,  1) =    22.78    
           dB_d2( 21,  2) =    21.54    
           dB_d2( 21,  3) =    48.93    
           dB_d2( 21,  4) =   -106.7    
           dB_d2( 21,  5) =    305.3    
           dB_d2( 21,  6) =   -84.45    
           dB_d2( 21,  7) =    9.610    
           dB_d2( 21,  8) =   -196.0    
           dB_d2( 21,  9) =    151.9    
           dB_d2( 21, 10) =   -35.85    
           dB_d2( 21, 11) =   -37.61    
           dB_d2( 21, 12) =   -33.58    
           dB_d2( 21, 13) =   -43.18    
           dB_d2( 21, 14) =   -25.15    
           dB_d2( 21, 15) =   -6.639    
           dB_d2( 21, 16) =   -29.83    
           dB_d2( 21, 17) =   -133.8    
           dB_d2( 21, 18) =   -35.17    
           dB_d2( 21, 19) =   -34.12    
           dB_d2( 21, 20) =    23.42    
           dB_d2( 21, 21) =  -0.4150    
           dB_d2( 22,  1) =    275.8    
           dB_d2( 22,  2) =    640.1    
           dB_d2( 22,  3) =   -31.03    
           dB_d2( 22,  4) =    77.58    
           dB_d2( 22,  5) =    432.3    
           dB_d2( 22,  6) =    13.82    
           dB_d2( 22,  7) =   -193.0    
           dB_d2( 22,  8) =   -367.1    
           dB_d2( 22,  9) =   -109.8    
           dB_d2( 22, 10) =   -91.60    
           dB_d2( 22, 11) =   -260.0    
           dB_d2( 22, 12) =    17.74    
           dB_d2( 22, 13) =   -315.0    
           dB_d2( 22, 14) =   -722.3    
           dB_d2( 22, 15) =    91.51    
           dB_d2( 22, 16) =   -74.50    
           dB_d2( 22, 17) =   -79.04    
           dB_d2( 22, 18) =   -103.2    
           dB_d2( 22, 19) =    13.60    
           dB_d2( 22, 20) =    59.63    
           dB_d2( 22, 21) =   -12.66    
           dB_d2( 23,  1) =   0.1000E+18
           dB_d2( 23,  2) =   0.1000E+18
           dB_d2( 23,  3) =   0.1000E+18
           dB_d2( 23,  4) =   0.2000E+18
           dB_d2( 23,  5) =   0.2000E+18
           dB_d2( 23,  6) =   0.2000E+18
           dB_d2( 23,  7) =   0.1000E+18
           dB_d2( 23,  8) =   0.1000E+18
           dB_d2( 23,  9) =   0.1000E+18
           dB_d2( 23, 10) =    0.000    
           dB_d2( 23, 11) =    0.000    
           dB_d2( 23, 12) =    0.000    
           dB_d2( 23, 13) =   0.1000E+18
           dB_d2( 23, 14) =   0.1000E+18
           dB_d2( 23, 15) =   0.1000E+18
           dB_d2( 23, 16) =    0.000    
           dB_d2( 23, 17) =    0.000    
           dB_d2( 23, 18) =    0.000    
           dB_d2( 23, 19) =   0.1000E+18
           dB_d2( 23, 20) =   0.1000E+18
           dB_d2( 23, 21) =   0.1000E+18
       
           ! Fill mlat arrays:
           min_mlat(  1) =     45.00
           max_mlat(  1) =     47.00
           min_mlat(  2) =     47.00
           max_mlat(  2) =     49.00
           min_mlat(  3) =     49.00
           max_mlat(  3) =     51.00
           min_mlat(  4) =     51.00
           max_mlat(  4) =     53.00
           min_mlat(  5) =     53.00
           max_mlat(  5) =     55.00
           min_mlat(  6) =     55.00
           max_mlat(  6) =     57.00
           min_mlat(  7) =     57.00
           max_mlat(  7) =     59.00
           min_mlat(  8) =     59.00
           max_mlat(  8) =     61.00
           min_mlat(  9) =     61.00
           max_mlat(  9) =     63.00
           min_mlat( 10) =     63.00
           max_mlat( 10) =     65.00
           min_mlat( 11) =     65.00
           max_mlat( 11) =     67.00
           min_mlat( 12) =     67.00
           max_mlat( 12) =     69.00
           min_mlat( 13) =     69.00
           max_mlat( 13) =     71.00
           min_mlat( 14) =     71.00
           max_mlat( 14) =     73.00
           min_mlat( 15) =     73.00
           max_mlat( 15) =     75.00
           min_mlat( 16) =     75.00
           max_mlat( 16) =     77.00
           min_mlat( 17) =     77.00
           max_mlat( 17) =     79.00
           min_mlat( 18) =     79.00
           max_mlat( 18) =     81.00
           min_mlat( 19) =     81.00
           max_mlat( 19) =     83.00
           min_mlat( 20) =     83.00
           max_mlat( 20) =     85.00
           min_mlat( 21) =     85.00
           max_mlat( 21) =     87.00
           min_mlat( 22) =     87.00
           max_mlat( 22) =     89.00
           min_mlat( 23) =     89.00
           max_mlat( 23) =     91.00
       
         end subroutine B_bmax_fill_coeff_arrays
       
       end module B_bmax_coeffmerge_mod
       
       !---------------------------------------------------------------------------
       !---------------------------------------------------------------------------
       
       subroutine B_bmax_calc_model_value(mlat_glob,mlt,sinT,imf_angle,
     |         value_Ed1,value_Ed2,value,value_found,FAC_value)
       
         ! This version is for public distribution, along with the module
         ! file coeff_mod.f90.
         !
         ! Within the /home/hensel/fortran/fit_data/public subdirectory,
         ! this program is called by call_de2_model.
       
         use common_model_mod, only: MMX,MXNMX,ITHMX, 
     |      mlat_resolution
       
         use B_bmax_model_mod, only: 
     |      pi,find_Btrans_function,find_imf_angle_function,
     |      find_sint_function
       
         use B_bmax_model_mod, only:  B_Bmax_number_of_MLT_coeffs,
     |      B_Bmax_number_of_Btrans_coeffs,
     |      B_Bmax_number_of_imf_angle_coeffs,
     |      B_Bmax_number_of_sinT_coeffs,value_dummy,AO => B_Bmax_AO,
     |      Q => B_Bmax_Q,DQ => B_Bmax_DQ,
     |      fit_by_Btrans => B_Bmax_fit_by_Btrans,fit_by_imf_angle => 
     |      B_Bmax_fit_by_imf_angle,fit_by_sinT => B_Bmax_fit_by_sinT,
     |      FAC_AO => Bmax_FAC_AO
       
         use qgen_mod, only: RI,ST,IBM,IEM,mcoef,dth,ns
       
         implicit none
       
         real, intent(in) :: mlat_glob,mlt,sinT,imf_angle
         real, intent(out) :: value_Ed1,value_Ed2,value
         logical,intent(out) :: value_found
         real, intent(out) :: FAC_value
       
       
         integer :: ith,m,k,ix,mm,iBtrans,iIMF_angle,isinT,fit_count, 
     |              iMLT
         integer :: m2iMLT(B_Bmax_number_of_MLT_coeffs)
         data m2iMLT /0,-1,1,-2,2,-3,3/ 
         real :: poten,etheta,ephi,FAC_poten,
     |        x,xm1,xp1,xp2,x0,sp,cp,sts,rst,qsoso,qsost,
     |        Btrans_function,imf_angle_function,sint_function
         real :: QS(-MMX:MMX,MXNMX),DQS(-MMX:MMX,MXNMX),F(-MMX:MMX)
         real :: fac_Y,Y,sinIm,mlat,get_sinIm
       
         ! General:
         logical, parameter :: debug = .false.
       
         !****************************************************************
         ! Interpolate to get coefficients for specified mlat:
         !****************************************************************
       
         value_found = .false.
         value_dummy = .true.
       
         ! Use absolute value of mlat:
         mlat = abs(mlat_glob)
       
         ! C Construct electric potential and electric field components 
         !C   (etheta equatorward, ephi eastward) 
         !C   on 2x10 degree grid, 0-40 colatitude
         !C Colatitudes (degrees) are in CLATD(0:ITHPLT)
         !C MLTs (hours) are in MLT(0:24)
         poten  = 0.
         etheta = 0.
         ephi   = 0.
         FAC_poten = 0.
         !C Calculate multipliers for cubic interpolation between latitudes where
         !C  Q, DQ are available
         X = (90.-mlat)*pi/180./DTH
         ITH = X
         ITH = MAX0(1,MIN0(ITHMX-2,ITH))
         X   = X - ITH
         XM1 = X*(-2. + X*(3. - X))/6.
         X0  = 1. + X*(-.5 + X*(-1. + .5*X))
         XP1 = X*(1. + X*(.5 - .5*X))
         XP2 = X*(-1. + X*X)/6.
       
         sp = sin(MLT*pi/12.)
         cp = COS(MLT*pi/12.)
         call FCMP_single(MMX,CP,SP,F)
       
         sts =  XM1* ST(ITH-1) + X0*ST(ITH)+ XP1*ST(ITH+1)+XP2*ST(ITH+2)   
       
         rst = RI*STS                                
         do iMLT = 1,B_Bmax_number_of_MLT_coeffs 
            m = m2iMLT(iMLT) 						     
            MM = IABS(M)
       
            Btrans_loop1:do iBtrans=1,1+(fit_by_Btrans
     |                 *B_Bmax_number_of_Btrans_coeffs-fit_by_Btrans)	 
               imf_angle_loop1:do iimf_angle=1,1+(fit_by_imf_angle
     |                    *B_Bmax_number_of_imf_angle_coeffs - 
     |                    fit_by_imf_angle)
                  imf_angle_function = 
     |                 find_imf_angle_function (iimf_angle,imf_angle) 
                  sint_loop1:do isint=1,1+(fit_by_sint
     |                       *B_Bmax_number_of_sint_coeffs-fit_by_sint)
                     sint_function = find_sint_function (isint,sint)   
       
       	      do K=1,	MXNMX					     
                        IX = K - 1						
                        QS(M,K) = XM1*Q(2*IX+NS(MM),ITH-1)+
     |                       X0*Q(2*IX+NS(MM),ITH) 
     |                       +XP1*Q(2*IX+NS(MM),ITH+1)+
     |                       XP2*Q(2*IX+NS(MM),ITH+2)
                        DQS(M,K) = XM1*DQ(2*IX+NS(MM),ITH-1)+
     |                       X0*DQ(2*IX+NS(MM),ITH)
     |                       +XP1*DQ(2*IX+NS(MM),ITH+1)+
     |                       XP2*DQ(2*IX+NS(MM),ITH+2) 
       
                        IF (ITH.GT.0) THEN
                           qsost = QS(M,K)/STS
                        ELSE
                           qsost = DQS(M,K)
                        ENDIF
			
                        poten=poten+AO(M,K,iBtrans,iimf_angle,isint)*
     |                        QS(M,K)*F(M)*
     |                        imf_angle_function*sint_function 
                        etheta= etheta + 
     |                        AO(M,K,iBtrans,iimf_angle,isint)*
     |                        DQS(M,K)*F(M)/RI*
     |                        imf_angle_function*sint_function 
                        ephi= ephi-AO(M,K,iBtrans,iimf_angle,isint)*
     |                        qsost*M*F(-M)/RI*
     |                        imf_angle_function*sint_function 
                        FAC_poten=FAC_poten+
     |                        FAC_AO(M,K,iBtrans,iimf_angle,isint)*
     |                        QS(M,K)*F(M)*
     |                        imf_angle_function*sint_function 
                     enddo
                  end do sint_loop1
               end do imf_angle_loop1
            end do Btrans_loop1
         enddo
       
         sinIm =  get_sinIm (mlat)  
         value     = poten
         FAC_value = FAC_poten
         value_Ed1 =  etheta/abs(sin(mlat*pi/180.))  ! dBd1
         value_Ed2 =  ephi/sqrt(0.25+0.75*           ! dBd2
     |            sin(mlat*pi/180.)**2)
         value_found = .true.
         value_dummy = .false.
       
         if (debug) then
            write(*,'(" for mlat=",F9.2,", MLT=",F9.2,":  ",G15.6)') 
     |                 mlat,MLT*180./24.,value
         end if
       
       
       end subroutine B_bmax_calc_model_value
       
       !---------------------------------------------------------------------------
       !---------------------------------------------------------------------------
       
       subroutine B_bmax_set_coeff_array
       
         use common_model_mod, only: nmlat,average_mlat
         use B_bmax_coeffmerge_mod, only: dB_d1,dB_d2,
     |     B_bmax_fill_coeff_arrays
         use B_bmax_model_mod, only: nfit => B_Bmax_nfit,
     |     b_Ed1 => B_Bmax_b_Ed1,b_Ed2 => B_Bmax_b_Ed2,b_interp_Ed1,
     |     b_interp_Ed2,b_90_Ed1,b_90_Ed2,x,imlat,ifit,
     |     B_Bmax_number_of_MLT_coeffs,
     |     B_Bmax_number_of_Btrans_coeffs,
     |     B_Bmax_number_of_imf_angle_coeffs,
     |     B_Bmax_number_of_sinT_coeffs,
     |     fit_by_MLT,pi,
     |     fit_by_Btrans => B_Bmax_fit_by_Btrans, 
     |     fit_by_imf_angle => B_Bmax_fit_by_imf_angle, 
     |     fit_by_sinT => B_Bmax_fit_by_sinT 
       
       
         integer :: binary_fit_by,check_dim
         integer :: iMLT,iBtrans,iimf_angle,isinT,fit_count
         real :: fac_ed1, fac_ed2, colat
         real :: fac_Y,Y
       
         !****************************************************************
         ! Fill parameter arrays:
         !****************************************************************
         call B_bmax_fill_coeff_arrays
       
         !****************************************************************
         ! Determine array dimensions.  Arrays for data type 'potential'
         ! are the same size as arrays for other data types.
         !****************************************************************
       
         nmlat = size(dB_d1,1)
         nfit  = size(dB_d1,2)
       
         ! check dimensions
         check_dim = B_Bmax_number_of_MLT_coeffs*
     |        B_Bmax_number_of_Btrans_coeffs*
     |        B_Bmax_number_of_imf_angle_coeffs*
     |        B_Bmax_number_of_sinT_coeffs
         if(check_dim /= nfit) then
            write(6,'("choose_coeff_array: wrong dimensions ", 2i4)') 
     |            nfit,check_dim
            stop
         endif
         !****************************************************************
         ! Allocate arrays into which coefficients will be transferred:
         !****************************************************************
         allocate(b_Ed1(nmlat,nfit),b_Ed2(nmlat,nfit),
     |       b_interp_Ed1(nfit),
     |       b_interp_Ed2(nfit),x(nfit),
     |       b_90_Ed1(nfit),b_90_Ed2(nfit))
       
         !****************************************************************
         ! Transfer values:
         !****************************************************************
       
         do imlat=1,nmlat
            do ifit=1,nfit
              if(abs(dB_d1(imlat,ifit))>=0.5000E+17)dB_d1(imlat,ifit)=0.
              if(abs(dB_d2(imlat,ifit))>=0.5000E+17)dB_d2(imlat,ifit)=0.
       
              b_Ed1(imlat,ifit) = abs(sin(average_mlat(imlat)*pi/180.))*
     |            dB_d2(imlat,ifit)/2**0.5
              b_Ed2(imlat,ifit) = sqrt(0.25+0.75*
     |            sin(average_mlat(imlat)*pi/180.)**2)*
     |            dB_d1(imlat,ifit)/2**0.5
            end do
         end do
       
       end subroutine B_bmax_set_coeff_array
