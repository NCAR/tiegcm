      module E_bmax_model_mod
      
        use common_model_mod, only: MMX,MXNMX,ITHMX,NQ,pi,fit_by_MLT
      
        implicit none
      
        logical :: value_dummy
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Arrays for fit coefficients:
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Number of fit coefficients for each mlat:
        integer :: E_Bmax_nfit
        ! Fit coefficients (dimension nmlat x nfit):
        real, allocatable, dimension(:,:) :: E_Bmax_b_Ed1,E_Bmax_b_Ed2 ! nmlat x nfit
        ! Interpolated fit coefficients (dimension nfit):
        real, allocatable, dimension(:) :: b_interp_Ed1,b_interp_Ed2
        ! Fitting functions (dimension nfit):
        real, allocatable, dimension(:) :: x
        ! Fit coefficients averaged over the pole (dimension nfit):
        real, allocatable, dimension(:) :: b_90_Ed1,b_90_Ed2
        ! Number of fit functions used by fit_data:
        integer, parameter :: E_Bmax_number_of_MLT_coeffs = 7,
     |      E_Bmax_number_of_Btrans_coeffs = 1,
     |        E_Bmax_number_of_imf_angle_coeffs = 3,
     |        E_Bmax_number_of_sinT_coeffs = 1
        ! Indices:
        integer :: imlat,ifit
      
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Data smoothing:
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        logical :: do_smooth
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Results
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        real :: value, value_Ed1, value_Ed2
        logical :: value_found, fit_found
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Qgen variables
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        real ::  E_Bmax_AO(-MMX:MMX,MXNMX,
     |     E_Bmax_number_of_Btrans_coeffs,
     |     E_Bmax_number_of_imf_angle_coeffs,
     |     E_Bmax_number_of_sinT_coeffs)
        real :: E_Bmax_Q(NQ,0:ITHMX),E_Bmax_DQ(NQ,0:ITHMX)
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        ! Coeffmerge
        !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        integer, parameter :: 
     |         E_Bmax_fit_by_Btrans = 0,
     |         E_Bmax_fit_by_imf_angle = 1,
     |         E_Bmax_fit_by_sinT = 0
      
      contains
      
        function find_MLT_function (index,MLT_in) result (MLT_fxn_out)
          integer :: index
          real :: MLT_in, MLT_fxn_out
      
          select case (index)
          case (0) 
             MLT_fxn_out = 1.
          case (1)
             MLT_fxn_out = 1.
          case (2)
             MLT_fxn_out = cos(pi*MLT_in/12.)
          case (3)
             MLT_fxn_out = sin(pi*MLT_in/12.)
          case (4)
             MLT_fxn_out = cos(pi*MLT_in/6.)
          case (5)
             MLT_fxn_out = sin(pi*MLT_in/6.)
          case (6)
             MLT_fxn_out = cos(pi*MLT_in/4.)
          case (7)
             MLT_fxn_out = sin(pi*MLT_in/4.)
          end select
        end function find_MLT_function
      
        function find_Btrans_function (index,Btrans_in) 
     |        result (Btrans_fxn_out)
          integer :: index
          real :: Btrans_in, Btrans_fxn_out
          real, parameter :: beta_inf = 16.
      
          select case (index)
          case (0) 
             Btrans_fxn_out = 1.
          case (1)
             Btrans_fxn_out = 1.
          case (2)
             Btrans_fxn_out = btrans_in /sqrt(1.+
     |        (btrans_in*btrans_in)/(beta_inf*beta_inf))
          case (3)
             Btrans_fxn_out = (Btrans_in/5.2 - 1.)**2
          end select
        end function find_Btrans_function
      
        function find_imf_angle_function (index,imf_angle_in) 
     |        result (imf_angle_fxn_out)
          integer :: index
          real :: imf_angle_in, imf_angle_fxn_out
      
          select case (index)
          case (0) 
             imf_angle_fxn_out = 1.
          case (1)
             imf_angle_fxn_out = 1.
          case (2)
             imf_angle_fxn_out = cos(imf_angle_in)
          case (3)
             imf_angle_fxn_out = sin(imf_angle_in)
          case (4)
             imf_angle_fxn_out = cos(2.*imf_angle_in)
          case (5)
             imf_angle_fxn_out = sin(2.*imf_angle_in)
          end select
        end function find_imf_angle_function
      
        function find_sinT_function (index,sinT_in) result(sinT_fxn_out)
          integer :: index
          real :: sinT_in, sinT_fxn_out
      
          select case (index)
          case (0) 
             sinT_fxn_out = 1.
          case (1)
             sinT_fxn_out = 1.
          case (2)
             sinT_fxn_out = sinT_in
          case (3)
             sinT_fxn_out = sinT_in**2
          end select
        end function find_sinT_function
      
      end module E_bmax_model_mod
      
      !---------------------------------------------------------------------------
      !---------------------------------------------------------------------------
      
      module E_bmax_coeffmerge_mod
      
        ! Merged coefficients from Em and Er to one set
        ! of Fourier series coefficients
        ! done for program in amie_calc_elpot_ed1ed2
      
        ! This module file created 2007/05/11.
        ! with the following parameters:
        !   for 81249-83047 period 
        !   fit_by_Btrans = 0
        !   fit_by_imf_angle = 1
        !   fit_by_sinT = 0
        !   mlat_resolution = 2
      
        ! To use this module, include the statement
        !   use coeffmerge_mod
        ! and the subroutine call
        !   call fill_coeff_arrays
        ! in Fortran90 programs.
        ! 
        ! Compilation will be slow; a Makefile is suggested!
        implicit none
        save
        real,  dimension( 23, 21) :: Ed1_sq2 
        real,  dimension( 23, 21) :: Ed2_sq2 
        real,  dimension( 23) :: min_mlat,max_mlat!,average_mlat
      
      contains
      
        subroutine E_bmax_fill_coeff_arrays
      
          ! Fill Ed1_sq2 arrays:
          Ed1_sq2(  1,  1) =    0.000    
          Ed1_sq2(  1,  2) =    0.000    
          Ed1_sq2(  1,  3) =    0.000    
          Ed1_sq2(  1,  4) =   0.1000E+18
          Ed1_sq2(  1,  5) =   0.1000E+18
          Ed1_sq2(  1,  6) =   0.1000E+18
          Ed1_sq2(  1,  7) =    0.000    
          Ed1_sq2(  1,  8) =    0.000    
          Ed1_sq2(  1,  9) =    0.000    
          Ed1_sq2(  1, 10) =   0.1000E+18
          Ed1_sq2(  1, 11) =   0.1000E+18
          Ed1_sq2(  1, 12) =   0.1000E+18
          Ed1_sq2(  1, 13) =    0.000    
          Ed1_sq2(  1, 14) =    0.000    
          Ed1_sq2(  1, 15) =    0.000    
          Ed1_sq2(  1, 16) =   0.1000E+18
          Ed1_sq2(  1, 17) =   0.1000E+18
          Ed1_sq2(  1, 18) =   0.1000E+18
          Ed1_sq2(  1, 19) =    0.000    
          Ed1_sq2(  1, 20) =    0.000    
          Ed1_sq2(  1, 21) =    0.000    
          Ed1_sq2(  2,  1) =   -1.174    
          Ed1_sq2(  2,  2) =   -1.217    
          Ed1_sq2(  2,  3) =  -0.4991    
          Ed1_sq2(  2,  4) =    2.770    
          Ed1_sq2(  2,  5) =  -0.2665    
          Ed1_sq2(  2,  6) =  -0.3138    
          Ed1_sq2(  2,  7) =   0.1592    
          Ed1_sq2(  2,  8) =    1.781    
          Ed1_sq2(  2,  9) =   0.2590E-01
          Ed1_sq2(  2, 10) =   0.1000E-01
          Ed1_sq2(  2, 11) =   -2.376    
          Ed1_sq2(  2, 12) =   0.2898    
          Ed1_sq2(  2, 13) =   -2.234    
          Ed1_sq2(  2, 14) =   -2.505    
          Ed1_sq2(  2, 15) =  -0.9093    
          Ed1_sq2(  2, 16) =   -1.223    
          Ed1_sq2(  2, 17) =   -3.539    
          Ed1_sq2(  2, 18) =   -1.362    
          Ed1_sq2(  2, 19) =  -0.4732    
          Ed1_sq2(  2, 20) =  -0.2220    
          Ed1_sq2(  2, 21) =  -0.6209    
          Ed1_sq2(  3,  1) =  -0.9954    
          Ed1_sq2(  3,  2) =  -0.7649    
          Ed1_sq2(  3,  3) =  -0.3769    
          Ed1_sq2(  3,  4) =    2.419    
          Ed1_sq2(  3,  5) =    2.455    
          Ed1_sq2(  3,  6) =   -1.152    
          Ed1_sq2(  3,  7) =   -1.270    
          Ed1_sq2(  3,  8) =  -0.9005    
          Ed1_sq2(  3,  9) =  -0.8280    
          Ed1_sq2(  3, 10) =   0.2177    
          Ed1_sq2(  3, 11) =   -1.529    
          Ed1_sq2(  3, 12) =   0.3775E-01
          Ed1_sq2(  3, 13) =  -0.7845    
          Ed1_sq2(  3, 14) =  -0.2819    
          Ed1_sq2(  3, 15) =  -0.6048    
          Ed1_sq2(  3, 16) =   -1.333    
          Ed1_sq2(  3, 17) =   -2.608    
          Ed1_sq2(  3, 18) =   -1.272    
          Ed1_sq2(  3, 19) =  -0.3210    
          Ed1_sq2(  3, 20) =   0.2335    
          Ed1_sq2(  3, 21) =  -0.9983    
          Ed1_sq2(  4,  1) =  -0.3737    
          Ed1_sq2(  4,  2) =  -0.4360    
          Ed1_sq2(  4,  3) =   0.4650E-02
          Ed1_sq2(  4,  4) =    3.131    
          Ed1_sq2(  4,  5) =    3.103    
          Ed1_sq2(  4,  6) =   -1.390    
          Ed1_sq2(  4,  7) =   -2.181    
          Ed1_sq2(  4,  8) =   -1.125    
          Ed1_sq2(  4,  9) =   -1.619    
          Ed1_sq2(  4, 10) =  -0.4197    
          Ed1_sq2(  4, 11) =   -2.954    
          Ed1_sq2(  4, 12) =  -0.2559    
          Ed1_sq2(  4, 13) =  -0.5695    
          Ed1_sq2(  4, 14) =   0.1415    
          Ed1_sq2(  4, 15) =  -0.7703    
          Ed1_sq2(  4, 16) =   -1.788    
          Ed1_sq2(  4, 17) =   -3.334    
          Ed1_sq2(  4, 18) =   -1.866    
          Ed1_sq2(  4, 19) =   0.7175    
          Ed1_sq2(  4, 20) =    2.121    
          Ed1_sq2(  4, 21) =  -0.7311    
          Ed1_sq2(  5,  1) =  -0.2793    
          Ed1_sq2(  5,  2) =   0.4785    
          Ed1_sq2(  5,  3) =  -0.1937    
          Ed1_sq2(  5,  4) =    3.872    
          Ed1_sq2(  5,  5) =    5.487    
          Ed1_sq2(  5,  6) =   -1.699    
          Ed1_sq2(  5,  7) =  -0.7033    
          Ed1_sq2(  5,  8) =   0.5941    
          Ed1_sq2(  5,  9) =  -0.8017    
          Ed1_sq2(  5, 10) =   0.4530    
          Ed1_sq2(  5, 11) =   -2.461    
          Ed1_sq2(  5, 12) =   0.7390E-01
          Ed1_sq2(  5, 13) =    1.997    
          Ed1_sq2(  5, 14) =    3.015    
          Ed1_sq2(  5, 15) =  -0.5415E-01
          Ed1_sq2(  5, 16) =   -1.459    
          Ed1_sq2(  5, 17) =   -4.128    
          Ed1_sq2(  5, 18) =   -1.567    
          Ed1_sq2(  5, 19) =    2.141    
          Ed1_sq2(  5, 20) =    4.550    
          Ed1_sq2(  5, 21) =  -0.7886    
          Ed1_sq2(  6,  1) =  -0.7988    
          Ed1_sq2(  6,  2) =  -0.1405    
          Ed1_sq2(  6,  3) =   0.5400E-02
          Ed1_sq2(  6,  4) =    3.529    
          Ed1_sq2(  6,  5) =    6.654    
          Ed1_sq2(  6,  6) =   -1.681    
          Ed1_sq2(  6,  7) =  -0.4666    
          Ed1_sq2(  6,  8) =    1.561    
          Ed1_sq2(  6,  9) =  -0.9449    
          Ed1_sq2(  6, 10) =   0.5321    
          Ed1_sq2(  6, 11) =   -2.919    
          Ed1_sq2(  6, 12) =   0.7994    
          Ed1_sq2(  6, 13) =   0.8650    
          Ed1_sq2(  6, 14) =    1.497    
          Ed1_sq2(  6, 15) =    1.112    
          Ed1_sq2(  6, 16) =  -0.6740    
          Ed1_sq2(  6, 17) =   -3.988    
          Ed1_sq2(  6, 18) =  -0.6130    
          Ed1_sq2(  6, 19) =    2.681    
          Ed1_sq2(  6, 20) =    5.317    
          Ed1_sq2(  6, 21) =   -1.168    
          Ed1_sq2(  7,  1) =   -1.645    
          Ed1_sq2(  7,  2) =    1.051    
          Ed1_sq2(  7,  3) =  -0.3396    
          Ed1_sq2(  7,  4) =    2.703    
          Ed1_sq2(  7,  5) =    11.12    
          Ed1_sq2(  7,  6) =   -1.967    
          Ed1_sq2(  7,  7) =   -1.539    
          Ed1_sq2(  7,  8) =   0.9854    
          Ed1_sq2(  7,  9) =  -0.3374    
          Ed1_sq2(  7, 10) =   0.6491    
          Ed1_sq2(  7, 11) =    1.405    
          Ed1_sq2(  7, 12) =    1.286    
          Ed1_sq2(  7, 13) =  -0.5100    
          Ed1_sq2(  7, 14) =    2.266    
          Ed1_sq2(  7, 15) =    1.655    
          Ed1_sq2(  7, 16) =  -0.8285    
          Ed1_sq2(  7, 17) =   -1.110    
          Ed1_sq2(  7, 18) =   0.1662    
          Ed1_sq2(  7, 19) =    3.230    
          Ed1_sq2(  7, 20) =    6.257    
          Ed1_sq2(  7, 21) =   -1.608    
          Ed1_sq2(  8,  1) =   -1.361    
          Ed1_sq2(  8,  2) =    1.918    
          Ed1_sq2(  8,  3) =  -0.7382    
          Ed1_sq2(  8,  4) =    2.397    
          Ed1_sq2(  8,  5) =    14.33    
          Ed1_sq2(  8,  6) =   -3.243    
          Ed1_sq2(  8,  7) =   -1.743    
          Ed1_sq2(  8,  8) =   0.6505    
          Ed1_sq2(  8,  9) =   0.9990E-01
          Ed1_sq2(  8, 10) =   0.3035    
          Ed1_sq2(  8, 11) =    3.214    
          Ed1_sq2(  8, 12) =   0.3209    
          Ed1_sq2(  8, 13) =  -0.9500    
          Ed1_sq2(  8, 14) =    2.337    
          Ed1_sq2(  8, 15) =   0.6795    
          Ed1_sq2(  8, 16) =   -2.224    
          Ed1_sq2(  8, 17) =  -0.9850    
          Ed1_sq2(  8, 18) =  -0.4015    
          Ed1_sq2(  8, 19) =    2.775    
          Ed1_sq2(  8, 20) =    6.223    
          Ed1_sq2(  8, 21) =   -2.452    
          Ed1_sq2(  9,  1) =   -1.503    
          Ed1_sq2(  9,  2) =    1.315    
          Ed1_sq2(  9,  3) =  -0.4675    
          Ed1_sq2(  9,  4) =    2.297    
          Ed1_sq2(  9,  5) =    17.47    
          Ed1_sq2(  9,  6) =   -3.220    
          Ed1_sq2(  9,  7) =   -3.367    
          Ed1_sq2(  9,  8) =   -4.120    
          Ed1_sq2(  9,  9) =   -1.702    
          Ed1_sq2(  9, 10) =   0.8742    
          Ed1_sq2(  9, 11) =    2.146    
          Ed1_sq2(  9, 12) =   0.1024    
          Ed1_sq2(  9, 13) =   -1.542    
          Ed1_sq2(  9, 14) =  -0.6749    
          Ed1_sq2(  9, 15) =   0.1925    
          Ed1_sq2(  9, 16) =   -2.507    
          Ed1_sq2(  9, 17) =   -2.200    
          Ed1_sq2(  9, 18) =   -1.279    
          Ed1_sq2(  9, 19) =    2.727    
          Ed1_sq2(  9, 20) =    6.561    
          Ed1_sq2(  9, 21) =   -3.475    
          Ed1_sq2( 10,  1) =   -2.549    
          Ed1_sq2( 10,  2) =  -0.8130    
          Ed1_sq2( 10,  3) =  -0.1985    
          Ed1_sq2( 10,  4) =   0.1890    
          Ed1_sq2( 10,  5) =    16.39    
          Ed1_sq2( 10,  6) =   -3.261    
          Ed1_sq2( 10,  7) =   -3.720    
          Ed1_sq2( 10,  8) =   -4.172    
          Ed1_sq2( 10,  9) =   -1.146    
          Ed1_sq2( 10, 10) =   0.6265    
          Ed1_sq2( 10, 11) =    3.420    
          Ed1_sq2( 10, 12) =    1.982    
          Ed1_sq2( 10, 13) =   -5.504    
          Ed1_sq2( 10, 14) =   -12.55    
          Ed1_sq2( 10, 15) =    1.296    
          Ed1_sq2( 10, 16) =   -2.769    
          Ed1_sq2( 10, 17) =   -4.435    
          Ed1_sq2( 10, 18) =   0.6266    
          Ed1_sq2( 10, 19) =    1.626    
          Ed1_sq2( 10, 20) =    1.174    
          Ed1_sq2( 10, 21) =   -2.214    
          Ed1_sq2( 11,  1) =   -1.207    
          Ed1_sq2( 11,  2) =  -0.6970    
          Ed1_sq2( 11,  3) =  -0.2152    
          Ed1_sq2( 11,  4) =  -0.8050    
          Ed1_sq2( 11,  5) =    19.16    
          Ed1_sq2( 11,  6) =   -1.091    
          Ed1_sq2( 11,  7) =   -6.288    
          Ed1_sq2( 11,  8) =   -14.42    
          Ed1_sq2( 11,  9) =   0.8545    
          Ed1_sq2( 11, 10) =   0.1495    
          Ed1_sq2( 11, 11) =    6.539    
          Ed1_sq2( 11, 12) =   0.3652    
          Ed1_sq2( 11, 13) =   -3.082    
          Ed1_sq2( 11, 14) =   -14.18    
          Ed1_sq2( 11, 15) =   0.4160    
          Ed1_sq2( 11, 16) =   -2.065    
          Ed1_sq2( 11, 17) =   -2.860    
          Ed1_sq2( 11, 18) =   -1.339    
          Ed1_sq2( 11, 19) =    3.367    
          Ed1_sq2( 11, 20) =    6.244    
          Ed1_sq2( 11, 21) =  -0.3075    
          Ed1_sq2( 12,  1) =   -2.490    
          Ed1_sq2( 12,  2) =   -5.736    
          Ed1_sq2( 12,  3) =  -0.7732    
          Ed1_sq2( 12,  4) =   -8.789    
          Ed1_sq2( 12,  5) =    12.39    
          Ed1_sq2( 12,  6) =   -1.765    
          Ed1_sq2( 12,  7) =   -6.188    
          Ed1_sq2( 12,  8) =   -20.37    
          Ed1_sq2( 12,  9) =    2.451    
          Ed1_sq2( 12, 10) =   -2.451    
          Ed1_sq2( 12, 11) =    5.634    
          Ed1_sq2( 12, 12) =   0.7958    
          Ed1_sq2( 12, 13) =  -0.6356    
          Ed1_sq2( 12, 14) =   -11.00    
          Ed1_sq2( 12, 15) =   0.5945    
          Ed1_sq2( 12, 16) =    2.930    
          Ed1_sq2( 12, 17) =    5.981    
          Ed1_sq2( 12, 18) =   -1.650    
          Ed1_sq2( 12, 19) =   0.7263    
          Ed1_sq2( 12, 20) =    6.610    
          Ed1_sq2( 12, 21) =   -1.727    
          Ed1_sq2( 13,  1) =    1.453    
          Ed1_sq2( 13,  2) =   0.3215    
          Ed1_sq2( 13,  3) =  -0.9075    
          Ed1_sq2( 13,  4) =   -8.801    
          Ed1_sq2( 13,  5) =    19.95    
          Ed1_sq2( 13,  6) =    1.362    
          Ed1_sq2( 13,  7) =   -2.819    
          Ed1_sq2( 13,  8) =   -10.18    
          Ed1_sq2( 13,  9) =    6.328    
          Ed1_sq2( 13, 10) =   -7.158    
          Ed1_sq2( 13, 11) =   -5.196    
          Ed1_sq2( 13, 12) =    1.642    
          Ed1_sq2( 13, 13) =    4.007    
          Ed1_sq2( 13, 14) =  -0.3563    
          Ed1_sq2( 13, 15) =    2.512    
          Ed1_sq2( 13, 16) =    2.915    
          Ed1_sq2( 13, 17) =    3.357    
          Ed1_sq2( 13, 18) =   -3.660    
          Ed1_sq2( 13, 19) =  -0.5185    
          Ed1_sq2( 13, 20) =    1.976    
          Ed1_sq2( 13, 21) =    3.598    
          Ed1_sq2( 14,  1) =    1.872    
          Ed1_sq2( 14,  2) =    1.356    
          Ed1_sq2( 14,  3) =   0.6384    
          Ed1_sq2( 14,  4) =   -13.53    
          Ed1_sq2( 14,  5) =    17.00    
          Ed1_sq2( 14,  6) =    3.426    
          Ed1_sq2( 14,  7) =   -2.921    
          Ed1_sq2( 14,  8) =   -12.26    
          Ed1_sq2( 14,  9) =    5.169    
          Ed1_sq2( 14, 10) =   -8.348    
          Ed1_sq2( 14, 11) =   -9.934    
          Ed1_sq2( 14, 12) =  -0.3310E-01
          Ed1_sq2( 14, 13) =    3.952    
          Ed1_sq2( 14, 14) =    2.472    
          Ed1_sq2( 14, 15) =    1.510    
          Ed1_sq2( 14, 16) =   0.1050    
          Ed1_sq2( 14, 17) =   -1.813    
          Ed1_sq2( 14, 18) =  -0.7960    
          Ed1_sq2( 14, 19) =   -3.580    
          Ed1_sq2( 14, 20) =   -4.617    
          Ed1_sq2( 14, 21) =    4.138    
          Ed1_sq2( 15,  1) =  -0.9095    
          Ed1_sq2( 15,  2) =  -0.6410    
          Ed1_sq2( 15,  3) =   -1.711    
          Ed1_sq2( 15,  4) =   -16.00    
          Ed1_sq2( 15,  5) =    19.65    
          Ed1_sq2( 15,  6) =    5.810    
          Ed1_sq2( 15,  7) =   0.7510    
          Ed1_sq2( 15,  8) =   -6.207    
          Ed1_sq2( 15,  9) =    3.326    
          Ed1_sq2( 15, 10) =   -6.592    
          Ed1_sq2( 15, 11) =   -10.63    
          Ed1_sq2( 15, 12) =    1.569    
          Ed1_sq2( 15, 13) =    6.227    
          Ed1_sq2( 15, 14) =    10.07    
          Ed1_sq2( 15, 15) =    2.835    
          Ed1_sq2( 15, 16) =    2.524    
          Ed1_sq2( 15, 17) =   -1.206    
          Ed1_sq2( 15, 18) =   -2.909    
          Ed1_sq2( 15, 19) =   -6.014    
          Ed1_sq2( 15, 20) =   -7.739    
          Ed1_sq2( 15, 21) =   0.8910    
          Ed1_sq2( 16,  1) =   -3.194    
          Ed1_sq2( 16,  2) =   -5.252    
          Ed1_sq2( 16,  3) =   0.4165    
          Ed1_sq2( 16,  4) =   -14.80    
          Ed1_sq2( 16,  5) =    20.77    
          Ed1_sq2( 16,  6) =    2.720    
          Ed1_sq2( 16,  7) =    1.808    
          Ed1_sq2( 16,  8) =   -9.646    
          Ed1_sq2( 16,  9) =    5.132    
          Ed1_sq2( 16, 10) =   -5.548    
          Ed1_sq2( 16, 11) =   -8.318    
          Ed1_sq2( 16, 12) =    2.692    
          Ed1_sq2( 16, 13) =    8.580    
          Ed1_sq2( 16, 14) =    11.98    
          Ed1_sq2( 16, 15) =    1.955    
          Ed1_sq2( 16, 16) =   0.8500E-01
          Ed1_sq2( 16, 17) =   -6.666    
          Ed1_sq2( 16, 18) =   -1.211    
          Ed1_sq2( 16, 19) =   -5.383    
          Ed1_sq2( 16, 20) =   -6.300    
          Ed1_sq2( 16, 21) =  -0.3255    
          Ed1_sq2( 17,  1) =   -5.980    
          Ed1_sq2( 17,  2) =   -10.14    
          Ed1_sq2( 17,  3) =   -1.018    
          Ed1_sq2( 17,  4) =   -7.111    
          Ed1_sq2( 17,  5) =    31.08    
          Ed1_sq2( 17,  6) =    4.934    
          Ed1_sq2( 17,  7) =  -0.8550    
          Ed1_sq2( 17,  8) =   -14.53    
          Ed1_sq2( 17,  9) =    7.076    
          Ed1_sq2( 17, 10) =   -7.220    
          Ed1_sq2( 17, 11) =   -10.88    
          Ed1_sq2( 17, 12) =    3.462    
          Ed1_sq2( 17, 13) =    9.816    
          Ed1_sq2( 17, 14) =    10.64    
          Ed1_sq2( 17, 15) =    1.065    
          Ed1_sq2( 17, 16) =    3.375    
          Ed1_sq2( 17, 17) =    1.506    
          Ed1_sq2( 17, 18) =   0.8000    
          Ed1_sq2( 17, 19) =   -5.779    
          Ed1_sq2( 17, 20) =   -6.955    
          Ed1_sq2( 17, 21) =   -4.127    
          Ed1_sq2( 18,  1) =   -3.910    
          Ed1_sq2( 18,  2) =   -5.860    
          Ed1_sq2( 18,  3) =  -0.6495    
          Ed1_sq2( 18,  4) =   -13.21    
          Ed1_sq2( 18,  5) =    26.09    
          Ed1_sq2( 18,  6) =    5.932    
          Ed1_sq2( 18,  7) =   0.4915    
          Ed1_sq2( 18,  8) =   -11.07    
          Ed1_sq2( 18,  9) =    10.88    
          Ed1_sq2( 18, 10) =   -2.465    
          Ed1_sq2( 18, 11) =   -6.890    
          Ed1_sq2( 18, 12) =    1.688    
          Ed1_sq2( 18, 13) =    6.559    
          Ed1_sq2( 18, 14) =    4.669    
          Ed1_sq2( 18, 15) =    3.115    
          Ed1_sq2( 18, 16) =    1.196    
          Ed1_sq2( 18, 17) =    4.635    
          Ed1_sq2( 18, 18) =   -2.832    
          Ed1_sq2( 18, 19) =  -0.5685    
          Ed1_sq2( 18, 20) =  -0.5300    
          Ed1_sq2( 18, 21) =   -3.116    
          Ed1_sq2( 19,  1) =    1.205    
          Ed1_sq2( 19,  2) =  -0.4000E-02
          Ed1_sq2( 19,  3) =   -2.191    
          Ed1_sq2( 19,  4) =   -18.73    
          Ed1_sq2( 19,  5) =    13.04    
          Ed1_sq2( 19,  6) =    6.829    
          Ed1_sq2( 19,  7) =    1.141    
          Ed1_sq2( 19,  8) =   -12.26    
          Ed1_sq2( 19,  9) =    17.11    
          Ed1_sq2( 19, 10) =  -0.7686    
          Ed1_sq2( 19, 11) =   -4.755    
          Ed1_sq2( 19, 12) =   0.1670    
          Ed1_sq2( 19, 13) =    3.385    
          Ed1_sq2( 19, 14) =    5.857    
          Ed1_sq2( 19, 15) =   -1.285    
          Ed1_sq2( 19, 16) =    1.297    
          Ed1_sq2( 19, 17) =    1.557    
          Ed1_sq2( 19, 18) =   -1.183    
          Ed1_sq2( 19, 19) =    2.937    
          Ed1_sq2( 19, 20) =    1.548    
          Ed1_sq2( 19, 21) =  -0.2990    
          Ed1_sq2( 20,  1) =   -2.391    
          Ed1_sq2( 20,  2) =   -1.901    
          Ed1_sq2( 20,  3) =   -1.053    
          Ed1_sq2( 20,  4) =   -15.91    
          Ed1_sq2( 20,  5) =    18.92    
          Ed1_sq2( 20,  6) =    6.964    
          Ed1_sq2( 20,  7) =    2.146    
          Ed1_sq2( 20,  8) =   -7.269    
          Ed1_sq2( 20,  9) =    11.82    
          Ed1_sq2( 20, 10) =  -0.6830    
          Ed1_sq2( 20, 11) =   -4.177    
          Ed1_sq2( 20, 12) =    2.809    
          Ed1_sq2( 20, 13) =   0.8725    
          Ed1_sq2( 20, 14) =    1.015    
          Ed1_sq2( 20, 15) =   -4.105    
          Ed1_sq2( 20, 16) =    3.176    
          Ed1_sq2( 20, 17) =    8.010    
          Ed1_sq2( 20, 18) =   0.1545    
          Ed1_sq2( 20, 19) =    2.584    
          Ed1_sq2( 20, 20) =    2.592    
          Ed1_sq2( 20, 21) =    5.825    
          Ed1_sq2( 21,  1) =  -0.6960    
          Ed1_sq2( 21,  2) =   -1.946    
          Ed1_sq2( 21,  3) =    1.529    
          Ed1_sq2( 21,  4) =   -16.81    
          Ed1_sq2( 21,  5) =    20.97    
          Ed1_sq2( 21,  6) =    6.412    
          Ed1_sq2( 21,  7) =   -1.162    
          Ed1_sq2( 21,  8) =   -7.347    
          Ed1_sq2( 21,  9) =    6.533    
          Ed1_sq2( 21, 10) =    2.905    
          Ed1_sq2( 21, 11) =    2.345    
          Ed1_sq2( 21, 12) =    2.246    
          Ed1_sq2( 21, 13) =    2.701    
          Ed1_sq2( 21, 14) =    2.330    
          Ed1_sq2( 21, 15) =   -3.325    
          Ed1_sq2( 21, 16) =    2.778    
          Ed1_sq2( 21, 17) =    4.822    
          Ed1_sq2( 21, 18) =   -2.215    
          Ed1_sq2( 21, 19) =  -0.1720    
          Ed1_sq2( 21, 20) =  -0.6740    
          Ed1_sq2( 21, 21) =  -0.1555    
          Ed1_sq2( 22,  1) =    2.254    
          Ed1_sq2( 22,  2) =    2.844    
          Ed1_sq2( 22,  3) =   -1.507    
          Ed1_sq2( 22,  4) =   -37.75    
          Ed1_sq2( 22,  5) =   -6.166    
          Ed1_sq2( 22,  6) =    9.146    
          Ed1_sq2( 22,  7) =  -0.7452    
          Ed1_sq2( 22,  8) =   -10.90    
          Ed1_sq2( 22,  9) =    5.971    
          Ed1_sq2( 22, 10) =   -4.047    
          Ed1_sq2( 22, 11) =   -5.299    
          Ed1_sq2( 22, 12) =    3.360    
          Ed1_sq2( 22, 13) =   -6.248    
          Ed1_sq2( 22, 14) =   -5.810    
          Ed1_sq2( 22, 15) =    1.177    
          Ed1_sq2( 22, 16) =    5.011    
          Ed1_sq2( 22, 17) =    8.089    
          Ed1_sq2( 22, 18) =   -2.954    
          Ed1_sq2( 22, 19) =    4.072    
          Ed1_sq2( 22, 20) =    5.826    
          Ed1_sq2( 22, 21) =   -1.819    
          Ed1_sq2( 23,  1) =   0.8520    
          Ed1_sq2( 23,  2) =   0.7271    
          Ed1_sq2( 23,  3) =    4.329    
          Ed1_sq2( 23,  4) =   -37.49    
          Ed1_sq2( 23,  5) =   -1.093    
          Ed1_sq2( 23,  6) =    14.45    
          Ed1_sq2( 23,  7) =    9.087    
          Ed1_sq2( 23,  8) =    1.586    
          Ed1_sq2( 23,  9) =    9.080    
          Ed1_sq2( 23, 10) =   0.6380    
          Ed1_sq2( 23, 11) =    1.119    
          Ed1_sq2( 23, 12) =   0.7805    
          Ed1_sq2( 23, 13) =  -0.5235    
          Ed1_sq2( 23, 14) =    1.096    
          Ed1_sq2( 23, 15) =   -1.071    
          Ed1_sq2( 23, 16) =   -2.130    
          Ed1_sq2( 23, 17) =   -2.114    
          Ed1_sq2( 23, 18) =   -5.717    
          Ed1_sq2( 23, 19) =   0.4320    
          Ed1_sq2( 23, 20) =   0.3250    
          Ed1_sq2( 23, 21) =   -1.559    
      
          ! Fill Ed2_sq2 arrays:
          Ed2_sq2(  1,  1) =   0.1000E+18
          Ed2_sq2(  1,  2) =   0.1000E+18
          Ed2_sq2(  1,  3) =   0.1000E+18
          Ed2_sq2(  1,  4) =   0.2000E+18
          Ed2_sq2(  1,  5) =   0.2000E+18
          Ed2_sq2(  1,  6) =   0.2000E+18
          Ed2_sq2(  1,  7) =   0.1000E+18
          Ed2_sq2(  1,  8) =   0.1000E+18
          Ed2_sq2(  1,  9) =   0.1000E+18
          Ed2_sq2(  1, 10) =    0.000    
          Ed2_sq2(  1, 11) =    0.000    
          Ed2_sq2(  1, 12) =    0.000    
          Ed2_sq2(  1, 13) =   0.1000E+18
          Ed2_sq2(  1, 14) =   0.1000E+18
          Ed2_sq2(  1, 15) =   0.1000E+18
          Ed2_sq2(  1, 16) =    0.000    
          Ed2_sq2(  1, 17) =    0.000    
          Ed2_sq2(  1, 18) =    0.000    
          Ed2_sq2(  1, 19) =   0.1000E+18
          Ed2_sq2(  1, 20) =   0.1000E+18
          Ed2_sq2(  1, 21) =   0.1000E+18
          Ed2_sq2(  2,  1) =   -4.552    
          Ed2_sq2(  2,  2) =   0.1665    
          Ed2_sq2(  2,  3) =   -1.007    
          Ed2_sq2(  2,  4) =   -1.709    
          Ed2_sq2(  2,  5) =    3.953    
          Ed2_sq2(  2,  6) =  -0.6987    
          Ed2_sq2(  2,  7) =    5.232    
          Ed2_sq2(  2,  8) =    4.181    
          Ed2_sq2(  2,  9) =   0.1320E-01
          Ed2_sq2(  2, 10) =    2.234    
          Ed2_sq2(  2, 11) =    2.505    
          Ed2_sq2(  2, 12) =   0.9093    
          Ed2_sq2(  2, 13) =   0.1000E-01
          Ed2_sq2(  2, 14) =   -2.376    
          Ed2_sq2(  2, 15) =   0.2898    
          Ed2_sq2(  2, 16) =   0.4732    
          Ed2_sq2(  2, 17) =   0.2220    
          Ed2_sq2(  2, 18) =   0.6209    
          Ed2_sq2(  2, 19) =   -1.223    
          Ed2_sq2(  2, 20) =   -3.539    
          Ed2_sq2(  2, 21) =   -1.362    
          Ed2_sq2(  3,  1) =   -3.657    
          Ed2_sq2(  3,  2) =    1.236    
          Ed2_sq2(  3,  3) =  -0.8791    
          Ed2_sq2(  3,  4) =   -2.534    
          Ed2_sq2(  3,  5) =    3.496    
          Ed2_sq2(  3,  6) =  -0.8015    
          Ed2_sq2(  3,  7) =    2.917    
          Ed2_sq2(  3,  8) =   -1.664    
          Ed2_sq2(  3,  9) =  -0.2244    
          Ed2_sq2(  3, 10) =   0.7845    
          Ed2_sq2(  3, 11) =   0.2819    
          Ed2_sq2(  3, 12) =   0.6048    
          Ed2_sq2(  3, 13) =   0.2177    
          Ed2_sq2(  3, 14) =   -1.529    
          Ed2_sq2(  3, 15) =   0.3775E-01
          Ed2_sq2(  3, 16) =   0.3210    
          Ed2_sq2(  3, 17) =  -0.2335    
          Ed2_sq2(  3, 18) =   0.9983    
          Ed2_sq2(  3, 19) =   -1.333    
          Ed2_sq2(  3, 20) =   -2.608    
          Ed2_sq2(  3, 21) =   -1.272    
          Ed2_sq2(  4,  1) =   -3.518    
          Ed2_sq2(  4,  2) =    3.605    
          Ed2_sq2(  4,  3) =  -0.9957    
          Ed2_sq2(  4,  4) =   -2.966    
          Ed2_sq2(  4,  5) =    6.457    
          Ed2_sq2(  4,  6) =  -0.8246    
          Ed2_sq2(  4,  7) =    3.127    
          Ed2_sq2(  4,  8) =   -4.959    
          Ed2_sq2(  4,  9) =  -0.4781    
          Ed2_sq2(  4, 10) =   0.5695    
          Ed2_sq2(  4, 11) =  -0.1415    
          Ed2_sq2(  4, 12) =   0.7703    
          Ed2_sq2(  4, 13) =  -0.4197    
          Ed2_sq2(  4, 14) =   -2.954    
          Ed2_sq2(  4, 15) =  -0.2559    
          Ed2_sq2(  4, 16) =  -0.7175    
          Ed2_sq2(  4, 17) =   -2.121    
          Ed2_sq2(  4, 18) =   0.7311    
          Ed2_sq2(  4, 19) =   -1.788    
          Ed2_sq2(  4, 20) =   -3.334    
          Ed2_sq2(  4, 21) =   -1.866    
          Ed2_sq2(  5,  1) =   -3.284    
          Ed2_sq2(  5,  2) =    5.629    
          Ed2_sq2(  5,  3) =   0.5218    
          Ed2_sq2(  5,  4) =   -4.437    
          Ed2_sq2(  5,  5) =    7.052    
          Ed2_sq2(  5,  6) =   0.7079    
          Ed2_sq2(  5,  7) =    6.172    
          Ed2_sq2(  5,  8) =   -3.427    
          Ed2_sq2(  5,  9) =  -0.6670    
          Ed2_sq2(  5, 10) =   -1.997    
          Ed2_sq2(  5, 11) =   -3.015    
          Ed2_sq2(  5, 12) =   0.5415E-01
          Ed2_sq2(  5, 13) =   0.4530    
          Ed2_sq2(  5, 14) =   -2.461    
          Ed2_sq2(  5, 15) =   0.7390E-01
          Ed2_sq2(  5, 16) =   -2.141    
          Ed2_sq2(  5, 17) =   -4.550    
          Ed2_sq2(  5, 18) =   0.7886    
          Ed2_sq2(  5, 19) =   -1.459    
          Ed2_sq2(  5, 20) =   -4.128    
          Ed2_sq2(  5, 21) =   -1.567    
          Ed2_sq2(  6,  1) =   -2.846    
          Ed2_sq2(  6,  2) =    5.997    
          Ed2_sq2(  6,  3) =   0.2984    
          Ed2_sq2(  6,  4) =   -1.678    
          Ed2_sq2(  6,  5) =    11.02    
          Ed2_sq2(  6,  6) =   -1.243    
          Ed2_sq2(  6,  7) =    9.351    
          Ed2_sq2(  6,  8) =   -3.284    
          Ed2_sq2(  6,  9) =   -2.899    
          Ed2_sq2(  6, 10) =  -0.8650    
          Ed2_sq2(  6, 11) =   -1.497    
          Ed2_sq2(  6, 12) =   -1.112    
          Ed2_sq2(  6, 13) =   0.5321    
          Ed2_sq2(  6, 14) =   -2.919    
          Ed2_sq2(  6, 15) =   0.7994    
          Ed2_sq2(  6, 16) =   -2.681    
          Ed2_sq2(  6, 17) =   -5.317    
          Ed2_sq2(  6, 18) =    1.168    
          Ed2_sq2(  6, 19) =  -0.6740    
          Ed2_sq2(  6, 20) =   -3.988    
          Ed2_sq2(  6, 21) =  -0.6130    
          Ed2_sq2(  7,  1) =   -3.021    
          Ed2_sq2(  7,  2) =   0.7545    
          Ed2_sq2(  7,  3) =    1.003    
          Ed2_sq2(  7,  4) =  -0.9090E-01
          Ed2_sq2(  7,  5) =    1.334    
          Ed2_sq2(  7,  6) =  -0.2186    
          Ed2_sq2(  7,  7) =    11.94    
          Ed2_sq2(  7,  8) =   -4.309    
          Ed2_sq2(  7,  9) =   -2.719    
          Ed2_sq2(  7, 10) =   0.5100    
          Ed2_sq2(  7, 11) =   -2.266    
          Ed2_sq2(  7, 12) =   -1.655    
          Ed2_sq2(  7, 13) =   0.6491    
          Ed2_sq2(  7, 14) =    1.405    
          Ed2_sq2(  7, 15) =    1.286    
          Ed2_sq2(  7, 16) =   -3.230    
          Ed2_sq2(  7, 17) =   -6.257    
          Ed2_sq2(  7, 18) =    1.608    
          Ed2_sq2(  7, 19) =  -0.8285    
          Ed2_sq2(  7, 20) =   -1.110    
          Ed2_sq2(  7, 21) =   0.1662    
          Ed2_sq2(  8,  1) =   -2.639    
          Ed2_sq2(  8,  2) =    1.172    
          Ed2_sq2(  8,  3) =    1.068    
          Ed2_sq2(  8,  4) =   0.2149    
          Ed2_sq2(  8,  5) =   -5.878    
          Ed2_sq2(  8,  6) =    1.136    
          Ed2_sq2(  8,  7) =    14.85    
          Ed2_sq2(  8,  8) =   -8.422    
          Ed2_sq2(  8,  9) =   0.1115    
          Ed2_sq2(  8, 10) =   0.9500    
          Ed2_sq2(  8, 11) =   -2.337    
          Ed2_sq2(  8, 12) =  -0.6795    
          Ed2_sq2(  8, 13) =   0.3035    
          Ed2_sq2(  8, 14) =    3.214    
          Ed2_sq2(  8, 15) =   0.3209    
          Ed2_sq2(  8, 16) =   -2.775    
          Ed2_sq2(  8, 17) =   -6.223    
          Ed2_sq2(  8, 18) =    2.452    
          Ed2_sq2(  8, 19) =   -2.224    
          Ed2_sq2(  8, 20) =  -0.9850    
          Ed2_sq2(  8, 21) =  -0.4015    
          Ed2_sq2(  9,  1) =   -3.102    
          Ed2_sq2(  9,  2) =   0.6431    
          Ed2_sq2(  9,  3) =    1.641    
          Ed2_sq2(  9,  4) =   0.9630    
          Ed2_sq2(  9,  5) =   -11.88    
          Ed2_sq2(  9,  6) =    1.344    
          Ed2_sq2(  9,  7) =    18.82    
          Ed2_sq2(  9,  8) =   -13.13    
          Ed2_sq2(  9,  9) =   0.4215    
          Ed2_sq2(  9, 10) =    1.542    
          Ed2_sq2(  9, 11) =   0.6749    
          Ed2_sq2(  9, 12) =  -0.1925    
          Ed2_sq2(  9, 13) =   0.8742    
          Ed2_sq2(  9, 14) =    2.146    
          Ed2_sq2(  9, 15) =   0.1024    
          Ed2_sq2(  9, 16) =   -2.727    
          Ed2_sq2(  9, 17) =   -6.561    
          Ed2_sq2(  9, 18) =    3.475    
          Ed2_sq2(  9, 19) =   -2.507    
          Ed2_sq2(  9, 20) =   -2.200    
          Ed2_sq2(  9, 21) =   -1.279    
          Ed2_sq2( 10,  1) =   -3.365    
          Ed2_sq2( 10,  2) =   -1.570    
          Ed2_sq2( 10,  3) =    3.282    
          Ed2_sq2( 10,  4) =    6.156    
          Ed2_sq2( 10,  5) =   -9.639    
          Ed2_sq2( 10,  6) =    2.602    
          Ed2_sq2( 10,  7) =    24.79    
          Ed2_sq2( 10,  8) =   -15.98    
          Ed2_sq2( 10,  9) =   -1.249    
          Ed2_sq2( 10, 10) =    5.504    
          Ed2_sq2( 10, 11) =    12.55    
          Ed2_sq2( 10, 12) =   -1.296    
          Ed2_sq2( 10, 13) =   0.6265    
          Ed2_sq2( 10, 14) =    3.420    
          Ed2_sq2( 10, 15) =    1.982    
          Ed2_sq2( 10, 16) =   -1.626    
          Ed2_sq2( 10, 17) =   -1.174    
          Ed2_sq2( 10, 18) =    2.214    
          Ed2_sq2( 10, 19) =   -2.769    
          Ed2_sq2( 10, 20) =   -4.435    
          Ed2_sq2( 10, 21) =   0.6266    
          Ed2_sq2( 11,  1) =   -1.429    
          Ed2_sq2( 11,  2) =   -1.575    
          Ed2_sq2( 11,  3) =    4.419    
          Ed2_sq2( 11,  4) =    8.480    
          Ed2_sq2( 11,  5) =   -13.69    
          Ed2_sq2( 11,  6) =    6.615    
          Ed2_sq2( 11,  7) =    25.09    
          Ed2_sq2( 11,  8) =   -21.74    
          Ed2_sq2( 11,  9) =  -0.2724    
          Ed2_sq2( 11, 10) =    3.082    
          Ed2_sq2( 11, 11) =    14.18    
          Ed2_sq2( 11, 12) =  -0.4160    
          Ed2_sq2( 11, 13) =   0.1495    
          Ed2_sq2( 11, 14) =    6.539    
          Ed2_sq2( 11, 15) =   0.3652    
          Ed2_sq2( 11, 16) =   -3.367    
          Ed2_sq2( 11, 17) =   -6.244    
          Ed2_sq2( 11, 18) =   0.3075    
          Ed2_sq2( 11, 19) =   -2.065    
          Ed2_sq2( 11, 20) =   -2.860    
          Ed2_sq2( 11, 21) =   -1.339    
          Ed2_sq2( 12,  1) =  -0.1838    
          Ed2_sq2( 12,  2) =   -2.377    
          Ed2_sq2( 12,  3) =   -3.641    
          Ed2_sq2( 12,  4) =    8.208    
          Ed2_sq2( 12,  5) =   -16.37    
          Ed2_sq2( 12,  6) =    3.339    
          Ed2_sq2( 12,  7) =    18.63    
          Ed2_sq2( 12,  8) =   -16.13    
          Ed2_sq2( 12,  9) =    2.534    
          Ed2_sq2( 12, 10) =   0.6356    
          Ed2_sq2( 12, 11) =    11.00    
          Ed2_sq2( 12, 12) =  -0.5945    
          Ed2_sq2( 12, 13) =   -2.451    
          Ed2_sq2( 12, 14) =    5.634    
          Ed2_sq2( 12, 15) =   0.7958    
          Ed2_sq2( 12, 16) =  -0.7263    
          Ed2_sq2( 12, 17) =   -6.610    
          Ed2_sq2( 12, 18) =    1.727    
          Ed2_sq2( 12, 19) =    2.930    
          Ed2_sq2( 12, 20) =    5.981    
          Ed2_sq2( 12, 21) =   -1.650    
          Ed2_sq2( 13,  1) =   -1.172    
          Ed2_sq2( 13,  2) =  -0.3529    
          Ed2_sq2( 13,  3) =   -10.55    
          Ed2_sq2( 13,  4) =    7.217    
          Ed2_sq2( 13,  5) =   -9.491    
          Ed2_sq2( 13,  6) =   -2.710    
          Ed2_sq2( 13,  7) =    19.25    
          Ed2_sq2( 13,  8) =    3.247    
          Ed2_sq2( 13,  9) =   -3.279    
          Ed2_sq2( 13, 10) =   -4.007    
          Ed2_sq2( 13, 11) =   0.3563    
          Ed2_sq2( 13, 12) =   -2.512    
          Ed2_sq2( 13, 13) =   -7.158    
          Ed2_sq2( 13, 14) =   -5.196    
          Ed2_sq2( 13, 15) =    1.642    
          Ed2_sq2( 13, 16) =   0.5185    
          Ed2_sq2( 13, 17) =   -1.976    
          Ed2_sq2( 13, 18) =   -3.598    
          Ed2_sq2( 13, 19) =    2.915    
          Ed2_sq2( 13, 20) =    3.357    
          Ed2_sq2( 13, 21) =   -3.660    
          Ed2_sq2( 14,  1) =   0.2900E-01
          Ed2_sq2( 14,  2) =    4.026    
          Ed2_sq2( 14,  3) =   -20.82    
          Ed2_sq2( 14,  4) =   -3.232    
          Ed2_sq2( 14,  5) =   -6.084    
          Ed2_sq2( 14,  6) =    2.649    
          Ed2_sq2( 14,  7) =    11.30    
          Ed2_sq2( 14,  8) =    16.82    
          Ed2_sq2( 14,  9) =   -4.576    
          Ed2_sq2( 14, 10) =   -3.952    
          Ed2_sq2( 14, 11) =   -2.472    
          Ed2_sq2( 14, 12) =   -1.510    
          Ed2_sq2( 14, 13) =   -8.348    
          Ed2_sq2( 14, 14) =   -9.934    
          Ed2_sq2( 14, 15) =  -0.3310E-01
          Ed2_sq2( 14, 16) =    3.580    
          Ed2_sq2( 14, 17) =    4.617    
          Ed2_sq2( 14, 18) =   -4.138    
          Ed2_sq2( 14, 19) =   0.1050    
          Ed2_sq2( 14, 20) =   -1.813    
          Ed2_sq2( 14, 21) =  -0.7960    
          Ed2_sq2( 15,  1) =  -0.8515    
          Ed2_sq2( 15,  2) =    7.479    
          Ed2_sq2( 15,  3) =   -25.31    
          Ed2_sq2( 15,  4) =   -7.235    
          Ed2_sq2( 15,  5) =   -4.156    
          Ed2_sq2( 15,  6) =    10.72    
          Ed2_sq2( 15,  7) =    2.995    
          Ed2_sq2( 15,  8) =    28.47    
          Ed2_sq2( 15,  9) =   -2.206    
          Ed2_sq2( 15, 10) =   -6.227    
          Ed2_sq2( 15, 11) =   -10.07    
          Ed2_sq2( 15, 12) =   -2.835    
          Ed2_sq2( 15, 13) =   -6.592    
          Ed2_sq2( 15, 14) =   -10.63    
          Ed2_sq2( 15, 15) =    1.569    
          Ed2_sq2( 15, 16) =    6.014    
          Ed2_sq2( 15, 17) =    7.739    
          Ed2_sq2( 15, 18) =  -0.8910    
          Ed2_sq2( 15, 19) =    2.524    
          Ed2_sq2( 15, 20) =   -1.206    
          Ed2_sq2( 15, 21) =   -2.909    
          Ed2_sq2( 16,  1) =   0.9015    
          Ed2_sq2( 16,  2) =    14.05    
          Ed2_sq2( 16,  3) =   -26.14    
          Ed2_sq2( 16,  4) =   -7.918    
          Ed2_sq2( 16,  5) =   -8.474    
          Ed2_sq2( 16,  6) =    13.35    
          Ed2_sq2( 16,  7) =   -11.74    
          Ed2_sq2( 16,  8) =    14.93    
          Ed2_sq2( 16,  9) =  -0.4861    
          Ed2_sq2( 16, 10) =   -8.580    
          Ed2_sq2( 16, 11) =   -11.98    
          Ed2_sq2( 16, 12) =   -1.955    
          Ed2_sq2( 16, 13) =   -5.548    
          Ed2_sq2( 16, 14) =   -8.318    
          Ed2_sq2( 16, 15) =    2.692    
          Ed2_sq2( 16, 16) =    5.383    
          Ed2_sq2( 16, 17) =    6.300    
          Ed2_sq2( 16, 18) =   0.3255    
          Ed2_sq2( 16, 19) =   0.8500E-01
          Ed2_sq2( 16, 20) =   -6.666    
          Ed2_sq2( 16, 21) =   -1.211    
          Ed2_sq2( 17,  1) =   -4.874    
          Ed2_sq2( 17,  2) =    6.914    
          Ed2_sq2( 17,  3) =   -22.58    
          Ed2_sq2( 17,  4) =    5.531    
          Ed2_sq2( 17,  5) =    12.63    
          Ed2_sq2( 17,  6) =    7.290    
          Ed2_sq2( 17,  7) =   -11.84    
          Ed2_sq2( 17,  8) =    19.00    
          Ed2_sq2( 17,  9) =   0.1760    
          Ed2_sq2( 17, 10) =   -9.816    
          Ed2_sq2( 17, 11) =   -10.64    
          Ed2_sq2( 17, 12) =   -1.065    
          Ed2_sq2( 17, 13) =   -7.220    
          Ed2_sq2( 17, 14) =   -10.88    
          Ed2_sq2( 17, 15) =    3.462    
          Ed2_sq2( 17, 16) =    5.779    
          Ed2_sq2( 17, 17) =    6.955    
          Ed2_sq2( 17, 18) =    4.127    
          Ed2_sq2( 17, 19) =    3.375    
          Ed2_sq2( 17, 20) =    1.506    
          Ed2_sq2( 17, 21) =   0.8000    
          Ed2_sq2( 18,  1) =   -2.515    
          Ed2_sq2( 18,  2) =    9.461    
          Ed2_sq2( 18,  3) =   -16.50    
          Ed2_sq2( 18,  4) =    7.099    
          Ed2_sq2( 18,  5) =    22.35    
          Ed2_sq2( 18,  6) =   -3.122    
          Ed2_sq2( 18,  7) =   -13.45    
          Ed2_sq2( 18,  8) =    18.23    
          Ed2_sq2( 18,  9) =    8.051    
          Ed2_sq2( 18, 10) =   -6.559    
          Ed2_sq2( 18, 11) =   -4.669    
          Ed2_sq2( 18, 12) =   -3.115    
          Ed2_sq2( 18, 13) =   -2.465    
          Ed2_sq2( 18, 14) =   -6.890    
          Ed2_sq2( 18, 15) =    1.688    
          Ed2_sq2( 18, 16) =   0.5685    
          Ed2_sq2( 18, 17) =   0.5300    
          Ed2_sq2( 18, 18) =    3.116    
          Ed2_sq2( 18, 19) =    1.196    
          Ed2_sq2( 18, 20) =    4.635    
          Ed2_sq2( 18, 21) =   -2.832    
          Ed2_sq2( 19,  1) =   -4.036    
          Ed2_sq2( 19,  2) =    8.323    
          Ed2_sq2( 19,  3) =   -14.85    
          Ed2_sq2( 19,  4) =    2.511    
          Ed2_sq2( 19,  5) =    18.10    
          Ed2_sq2( 19,  6) =   -12.80    
          Ed2_sq2( 19,  7) =   -18.03    
          Ed2_sq2( 19,  8) =    16.66    
          Ed2_sq2( 19,  9) =    2.921    
          Ed2_sq2( 19, 10) =   -3.385    
          Ed2_sq2( 19, 11) =   -5.857    
          Ed2_sq2( 19, 12) =    1.285    
          Ed2_sq2( 19, 13) =  -0.7686    
          Ed2_sq2( 19, 14) =   -4.755    
          Ed2_sq2( 19, 15) =   0.1670    
          Ed2_sq2( 19, 16) =   -2.937    
          Ed2_sq2( 19, 17) =   -1.548    
          Ed2_sq2( 19, 18) =   0.2990    
          Ed2_sq2( 19, 19) =    1.297    
          Ed2_sq2( 19, 20) =    1.557    
          Ed2_sq2( 19, 21) =   -1.183    
          Ed2_sq2( 20,  1) =    3.403    
          Ed2_sq2( 20,  2) =    12.74    
          Ed2_sq2( 20,  3) =   -6.004    
          Ed2_sq2( 20,  4) =    3.700    
          Ed2_sq2( 20,  5) =    18.13    
          Ed2_sq2( 20,  6) =   -14.28    
          Ed2_sq2( 20,  7) =   -25.25    
          Ed2_sq2( 20,  8) =    13.32    
          Ed2_sq2( 20,  9) =   0.7255    
          Ed2_sq2( 20, 10) =  -0.8725    
          Ed2_sq2( 20, 11) =   -1.015    
          Ed2_sq2( 20, 12) =    4.105    
          Ed2_sq2( 20, 13) =  -0.6830    
          Ed2_sq2( 20, 14) =   -4.177    
          Ed2_sq2( 20, 15) =    2.809    
          Ed2_sq2( 20, 16) =   -2.584    
          Ed2_sq2( 20, 17) =   -2.592    
          Ed2_sq2( 20, 18) =   -5.825    
          Ed2_sq2( 20, 19) =    3.176    
          Ed2_sq2( 20, 20) =    8.010    
          Ed2_sq2( 20, 21) =   0.1545    
          Ed2_sq2( 21,  1) =    1.614    
          Ed2_sq2( 21,  2) =    7.357    
          Ed2_sq2( 21,  3) =   -4.171    
          Ed2_sq2( 21,  4) =    5.912    
          Ed2_sq2( 21,  5) =    17.79    
          Ed2_sq2( 21,  6) =   -14.01    
          Ed2_sq2( 21,  7) =   -24.33    
          Ed2_sq2( 21,  8) =    15.41    
          Ed2_sq2( 21,  9) =   -3.838    
          Ed2_sq2( 21, 10) =   -2.701    
          Ed2_sq2( 21, 11) =   -2.330    
          Ed2_sq2( 21, 12) =    3.325    
          Ed2_sq2( 21, 13) =    2.905    
          Ed2_sq2( 21, 14) =    2.345    
          Ed2_sq2( 21, 15) =    2.246    
          Ed2_sq2( 21, 16) =   0.1720    
          Ed2_sq2( 21, 17) =   0.6740    
          Ed2_sq2( 21, 18) =   0.1555    
          Ed2_sq2( 21, 19) =    2.778    
          Ed2_sq2( 21, 20) =    4.822    
          Ed2_sq2( 21, 21) =   -2.215    
          Ed2_sq2( 22,  1) =   -2.071    
          Ed2_sq2( 22,  2) =   -1.250    
          Ed2_sq2( 22,  3) =   0.9311    
          Ed2_sq2( 22,  4) =   -7.995    
          Ed2_sq2( 22,  5) =    4.903    
          Ed2_sq2( 22,  6) =   -5.337    
          Ed2_sq2( 22,  7) =   -39.51    
          Ed2_sq2( 22,  8) =   -3.294    
          Ed2_sq2( 22,  9) =    7.841    
          Ed2_sq2( 22, 10) =    6.248    
          Ed2_sq2( 22, 11) =    5.810    
          Ed2_sq2( 22, 12) =   -1.177    
          Ed2_sq2( 22, 13) =   -4.047    
          Ed2_sq2( 22, 14) =   -5.299    
          Ed2_sq2( 22, 15) =    3.360    
          Ed2_sq2( 22, 16) =   -4.072    
          Ed2_sq2( 22, 17) =   -5.826    
          Ed2_sq2( 22, 18) =    1.819    
          Ed2_sq2( 22, 19) =    5.011    
          Ed2_sq2( 22, 20) =    8.089    
          Ed2_sq2( 22, 21) =   -2.954    
          Ed2_sq2( 23,  1) =   -5.207    
          Ed2_sq2( 23,  2) =   -4.936    
          Ed2_sq2( 23,  3) =   -1.278    
          Ed2_sq2( 23,  4) =   -4.351    
          Ed2_sq2( 23,  5) =    4.150    
          Ed2_sq2( 23,  6) =   -10.06    
          Ed2_sq2( 23,  7) =   -31.85    
          Ed2_sq2( 23,  8) =    4.525    
          Ed2_sq2( 23,  9) =    14.11    
          Ed2_sq2( 23, 10) =   0.5235    
          Ed2_sq2( 23, 11) =   -1.096    
          Ed2_sq2( 23, 12) =    1.071    
          Ed2_sq2( 23, 13) =   0.6380    
          Ed2_sq2( 23, 14) =    1.119    
          Ed2_sq2( 23, 15) =   0.7805    
          Ed2_sq2( 23, 16) =  -0.4320    
          Ed2_sq2( 23, 17) =  -0.3250    
          Ed2_sq2( 23, 18) =    1.559    
          Ed2_sq2( 23, 19) =   -2.130    
          Ed2_sq2( 23, 20) =   -2.114    
          Ed2_sq2( 23, 21) =   -5.717    
      
          ! Fill mlat arrays:
          min_mlat(  1) =     45.00
          max_mlat(  1) =     47.00
          min_mlat(  2) =     47.00
          max_mlat(  2) =     49.00
          min_mlat(  3) =     49.00
          max_mlat(  3) =     51.00
          min_mlat(  4) =     51.00
          max_mlat(  4) =     53.00
          min_mlat(  5) =     53.00
          max_mlat(  5) =     55.00
          min_mlat(  6) =     55.00
          max_mlat(  6) =     57.00
          min_mlat(  7) =     57.00
          max_mlat(  7) =     59.00
          min_mlat(  8) =     59.00
          max_mlat(  8) =     61.00
          min_mlat(  9) =     61.00
          max_mlat(  9) =     63.00
          min_mlat( 10) =     63.00
          max_mlat( 10) =     65.00
          min_mlat( 11) =     65.00
          max_mlat( 11) =     67.00
          min_mlat( 12) =     67.00
          max_mlat( 12) =     69.00
          min_mlat( 13) =     69.00
          max_mlat( 13) =     71.00
          min_mlat( 14) =     71.00
          max_mlat( 14) =     73.00
          min_mlat( 15) =     73.00
          max_mlat( 15) =     75.00
          min_mlat( 16) =     75.00
          max_mlat( 16) =     77.00
          min_mlat( 17) =     77.00
          max_mlat( 17) =     79.00
          min_mlat( 18) =     79.00
          max_mlat( 18) =     81.00
          min_mlat( 19) =     81.00
          max_mlat( 19) =     83.00
          min_mlat( 20) =     83.00
          max_mlat( 20) =     85.00
          min_mlat( 21) =     85.00
          max_mlat( 21) =     87.00
          min_mlat( 22) =     87.00
          max_mlat( 22) =     89.00
          min_mlat( 23) =     89.00
          max_mlat( 23) =     91.00
      
        end subroutine E_bmax_fill_coeff_arrays
      
      end module E_bmax_coeffmerge_mod
      
      !---------------------------------------------------------------------------
      !---------------------------------------------------------------------------
      
      subroutine E_bmax_calc_model_value(mlat_glob,mlt,sinT,imf_angle,
     |      value_Ed1,value_Ed2,value,value_found)
      
        ! This version is for public distribution, along with the module
        ! file coeff_mod.f90.
        !
        ! Within the /home/hensel/fortran/fit_data/public subdirectory,
        ! this program is called by call_de2_model.
      
        use common_model_mod, only: MMX,MXNMX,ITHMX,mlat_resolution
        use E_bmax_model_mod, only: 
     |          pi,find_Btrans_function,find_imf_angle_function,
     |          find_sint_function
      
        use E_bmax_model_mod, only:  E_Bmax_number_of_MLT_coeffs,
     |      E_Bmax_number_of_Btrans_coeffs,
     |      E_Bmax_number_of_imf_angle_coeffs,
     |      E_Bmax_number_of_sinT_coeffs,value_dummy, AO => E_Bmax_AO,
     |      Q => E_Bmax_Q, DQ => E_Bmax_DQ,
     |      fit_by_Btrans => E_Bmax_fit_by_Btrans,fit_by_imf_angle => 
     |      E_Bmax_fit_by_imf_angle,fit_by_sinT => E_Bmax_fit_by_sinT
        use qgen_mod, only: RI,ST,IBM,IEM,mcoef,dth,ns
      
        implicit none
      
        real, intent(in) :: mlat_glob,mlt,sinT,imf_angle
        real, intent(out) :: value_Ed1,value_Ed2,value
        logical, intent(out) :: value_found
      
        integer :: ith,m,k,ix,mm,iBtrans,iIMF_angle,isinT,fit_count, 
     |          iMLT
        integer :: m2iMLT(E_Bmax_number_of_MLT_coeffs)
        data m2iMLT /0,-1,1,-2,2,-3,3/ 
        real :: poten,etheta,ephi,x,xm1,xp1,xp2,x0,sp,cp, 
     |      sts,rst,qsoso,qsost,
     |      Btrans_function,imf_angle_function, 
     |      sint_function,sinim
        real :: QS(-MMX:MMX,MXNMX),DQS(-MMX:MMX,MXNMX),F(-MMX:MMX)
        real :: mlat,get_sinIm
      
        ! General:
        logical, parameter :: debug = .false.
      
        !****************************************************************
        ! Interpolate to get coefficients for specified mlat:
        !****************************************************************
      
        value_found = .false.
      
        ! Use absolute value of mlat:
        mlat = abs(mlat_glob)
      
        ! C Construct electric potential and electric field components 
        !C   (etheta equatorward, ephi eastward) 
        !C   on 2x10 degree grid, 0-40 colatitude
        !C Colatitudes (degrees) are in CLATD(0:ITHPLT)
        !C MLTs (hours) are in MLT(0:24)
        poten  = 0.
        etheta = 0.
        ephi   = 0.
        !C Calculate multipliers for cubic interpolation between latitudes where
        !C  Q, DQ are available
        X = (90.-mlat)*pi/180./DTH
        ITH = X
        ITH = MAX0(1,MIN0(ITHMX-2,ITH))
        X   = X - ITH
        XM1 = X*(-2. + X*(3. - X))/6.
        X0  = 1. + X*(-.5 + X*(-1. + .5*X))
        XP1 = X*(1. + X*(.5 - .5*X))
        XP2 = X*(-1. + X*X)/6.
      
        sp = sin(MLT*pi/12.)
        cp = COS(MLT*pi/12.)
        call FCMP_single(MMX,CP,SP,F)
      
        sts =  XM1* ST(ITH-1) + X0*ST(ITH)+ XP1*ST(ITH+1)+XP2*ST(ITH+2)   
      
        rst = RI*STS                                
        do iMLT = 1,E_Bmax_number_of_MLT_coeffs 
           m = m2iMLT(iMLT) 						     
           MM = IABS(M)
      
           Btrans_loop1:do iBtrans=1,1+(fit_by_Btrans
     |           *E_Bmax_number_of_Btrans_coeffs - fit_by_Btrans)
              imf_angle_loop1:do iimf_angle=1,1+(fit_by_imf_angle
     |              *E_Bmax_number_of_imf_angle_coeffs-fit_by_imf_angle)
                 imf_angle_function = 
     |                 find_imf_angle_function (iimf_angle,imf_angle)
                 sint_loop1:do isint=1,1+(fit_by_sint
     |                 *E_Bmax_number_of_sint_coeffs - fit_by_sint)
                    sint_function = find_sint_function (isint,sint) 
      
                    do K=1,   MXNMX  				      
                       IX = K - 1						 
                       QS(M,K) = XM1*Q(2*IX+NS(MM),ITH-1)+
     |	                   X0*Q(2*IX+NS(MM),ITH)+ 
     |                      XP1*Q(2*IX+NS(MM),ITH+1)+ 
     |                      XP2*Q(2*IX+NS(MM),ITH+2)
                       DQS(M,K) = XM1*DQ(2*IX+NS(MM),ITH-1)+
     |                      X0*DQ(2*IX+NS(MM),ITH)+ 
     |                      XP1*DQ(2*IX+NS(MM),ITH+1)+
     |                      XP2*DQ(2*IX+NS(MM),ITH+2)   
                       IF (ITH.GT.0) THEN
                          qsost = QS(M,K)/STS
                       ELSE
                          qsost = DQS(M,K)
                       ENDIF
                       poten  =poten +AO(M,K,iBtrans,iimf_angle,isint)*
     |                      QS(M,K)*F(M)*
     |                      imf_angle_function*sint_function
                       etheta =etheta+AO(M,K,iBtrans,iimf_angle,isint)*
     |                      DQS(M,K)*F(M)/RI*
     |                      imf_angle_function*sint_function
                       ephi	= ephi   - AO(M,K,iBtrans,iimf_angle,isint)*
     |                      qsost*M*F(-M)/RI*
     |                      imf_angle_function*sint_function
                    enddo
                 end do sint_loop1
              end do imf_angle_loop1
           end do Btrans_loop1
        enddo
      
      
        sinIm     =  get_sinIm (mlat)
        value     = poten*0.001   ! conversion from mV to V
        value_Ed1 =  ephi                    ! mV/m
        value_Ed2 = -etheta/sinIm            ! mV/m  colatitude direction
      
        value_found = .true.
      
      
      end subroutine E_bmax_calc_model_value
      
      !---------------------------------------------------------------------------
      !---------------------------------------------------------------------------
      
      subroutine E_Bmax_set_coeff_array
      
        use common_model_mod, only:nmlat,average_mlat
        use E_Bmax_coeffmerge_mod, only: Ed1_sq2,Ed2_sq2,
     |         E_Bmax_fill_coeff_arrays
        use E_Bmax_model_mod, only: nfit => E_Bmax_nfit,
     |    b_Ed1 => E_Bmax_b_Ed1,b_Ed2 => E_Bmax_b_Ed2,
     |    E_Bmax_b_Ed2,b_interp_Ed1,
     |    b_interp_Ed2,b_90_Ed1,b_90_Ed2,x,imlat,ifit,
     |    E_Bmax_number_of_MLT_coeffs,
     |    E_Bmax_number_of_Btrans_coeffs,
     |    E_Bmax_number_of_imf_angle_coeffs,
     |    E_Bmax_number_of_sinT_coeffs,
     |    fit_by_MLT,pi,
     |    fit_by_Btrans => E_Bmax_fit_by_Btrans, 
     |    fit_by_imf_angle => E_Bmax_fit_by_imf_angle, 
     |    fit_by_sinT => E_Bmax_fit_by_sinT	  

        integer :: binary_fit_by,check_dim
        integer :: iMLT,iBtrans,iimf_angle,isinT,fit_count
        real :: fac_ed1, fac_ed2, colat
      
        !****************************************************************
        ! Fill parameter arrays:
        !****************************************************************
        call E_Bmax_fill_coeff_arrays
      
        !****************************************************************
        ! Determine array dimensions.  Arrays for data type 'potential'
        ! are the same size as arrays for other data types.
        !****************************************************************
      
        nmlat = size(Ed1_sq2,1)
        nfit  = size(Ed1_sq2,2)
      
        ! check dimensions
        check_dim = E_Bmax_number_of_MLT_coeffs* 
     |        E_Bmax_number_of_Btrans_coeffs*
     |        E_Bmax_number_of_imf_angle_coeffs* 
     |        E_Bmax_number_of_sinT_coeffs
        if(check_dim /= nfit) then
           write(6,'("Bmax_choose_coeff_array:wrong dimensions ", 2i4)')
     |           nfit,check_dim
           stop
        endif
        !****************************************************************
        ! Allocate arrays into which coefficients will be transferred:
        !****************************************************************
        allocate(b_Ed1(nmlat,nfit),b_Ed2(nmlat,nfit), 
     |    b_interp_Ed1(nfit),b_interp_Ed2(nfit),x(nfit),
     |    b_90_Ed1(nfit),b_90_Ed2(nfit))
      
        !****************************************************************
        ! Transfer values:
        !****************************************************************
      
        do imlat=1,nmlat
           do ifit=1,nfit
              if(abs(Ed1_sq2(imlat,ifit)) >= 0.5000E+17)  
     |    Ed1_sq2(imlat,ifit)=0.
              if(abs(Ed2_sq2(imlat,ifit)) >= 0.5000E+17)  
     |    Ed2_sq2(imlat,ifit)=0.
              b_Ed1(imlat,ifit) = Ed1_sq2(imlat,ifit)/2**0.5
              b_Ed2(imlat,ifit) = -Ed2_sq2(imlat,ifit)/2**0.5
           end do
        end do
      
      end subroutine E_Bmax_set_coeff_array
                  
